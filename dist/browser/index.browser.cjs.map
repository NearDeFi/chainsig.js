{"version":3,"sources":["../../src/constants.ts","../../src/utils/index.ts","../../src/utils/cryptography.ts","../../src/chain-adapters/index.ts","../../src/chain-adapters/ChainAdapter.ts","../../src/chain-adapters/EVM/index.ts","../../src/chain-adapters/EVM/EVM.ts","../../src/chain-adapters/EVM/utils.ts","../../src/chain-adapters/Bitcoin/index.ts","../../src/chain-adapters/Bitcoin/Bitcoin.ts","../../src/chain-adapters/Bitcoin/utils.ts","../../src/chain-adapters/Bitcoin/BTCRpcAdapter/Mempool/Mempool.ts","../../src/chain-adapters/Bitcoin/BTCRpcAdapter/BTCRpcAdapter.ts","../../src/chain-adapters/Bitcoin/BTCRpcAdapter/index.ts","../../src/chain-adapters/Cosmos/index.ts","../../src/chain-adapters/Cosmos/utils.ts","../../src/chain-adapters/Cosmos/Cosmos.ts","../../src/chain-adapters/Solana/index.ts","../../src/chain-adapters/Solana/Solana.ts","../../src/contracts/index.ts","../../src/contracts/ChainSignatureContract.ts","../../src/contracts/near/index.ts","../../src/contracts/near/signAndSend/index.ts","../../src/contracts/near/signAndSend/keypair.ts","../../src/contracts/near/account.ts","../../src/contracts/near/constants.ts","../../src/contracts/near/ChainSignatureContract.ts","../../src/utils/publicKey.ts","../../src/contracts/near/transaction.ts"],"names":["constants_exports","__export","CONTRACT_ADDRESSES","ENVS","KDF_CHAIN_ID","ROOT_PUBLIC_KEYS","utils_exports","cryptography_exports","compressPubKey","deriveChildPublicKey","najToUncompressedPubKeySEC1","toRSV","signature","uncompressedPubKeySEC1","slicedPubKey","x","y","najPublicKey","decodedKey","base58","rootUncompressedPubKeySEC1","predecessorId","path","chainId","ec","EC","derivationPath","scalarHex","sha3_256","oldPublicKeyPoint","scalarTimesG","newPublicKeyPoint","newX","newY","chain_adapters_exports","ChainAdapter","Bitcoin_exports","Cosmos_exports","EVM_exports","Solana_exports","EVM","fetchEVMFeeProperties","client","transaction","gas","feeData","maxFeePerGas","maxPriorityFeePerGas","publicClient","contract","fees","nonce","from","rest","r","s","yParity","concatHex","numberToHex","predecessor","uncompressedPubKey","publicKeyNoPrefix","hash","keccak256","getAddress","address","serializeTransaction","serialized","parseTransaction","transactionRequest","serializedTx","txHash","toBytes","message","hashMessage","typedDataRequest","hashTypedData","userOp","entryPointAddress","chainIdArgs","entryPoint","encoded","encodeAbiParameters","hexToBigInt","concat","pad","isAddress","userOpHash","rsvSignatures","rsvSignature","txSerialized","error","BTCRpcAdapter","BTCRpcAdapters","Bitcoin","parseBTCNetwork","network","O","_Bitcoin","btcRpcAdapter","satoshis","btc","transactionId","data","tx","f","vout","scriptPubKey","rawSignature","inputs","outputs","psbt","input","prevOut","out","derivedKey","publicKeyBuffer","payment","transactionJSON","psbtHex","hashesToSign","mockKeyPair","index","publicKey","keyPair","mpcSignature","Mempool","providerUrl","confirmationTarget","targets","utxos","feeRate","ret","coinselect","transactionHex","response","txid","Cosmos","fetchChainInfo","chainInfo","chains","chain","prefix","expectedChainId","denom","rpcUrl","restUrl","gasPrice","asset","assets","decimals","unit","endpoints","Registry","fromHex","amount","b","pubKeySha256","sha256","ripemd160Hash","ripemd160","bech32","TxRaw","toBase64","fromBase64","publicKeyBytes","gasLimit","fee","calculateFee","GasPrice","accountOnChain","StargateClient","accountNumber","sequence","txBodyEncodeObject","txBodyBytes","pubkey","encodePubkey","encodeSecp256k1Pubkey","authInfoBytes","makeAuthInfoBytes","SignMode","signDoc","makeSignDoc","signBytes","makeSignBytes","payload","sig","txBytes","broadcastResponse","Solana","toBigInt","value","args","PublicKey","balance","base58Key","buffer","Transaction","request","SystemProgram","blockhash","messageBytes","senderAddress","signatureBuffer","contracts_exports","ChainSignatureContract","near_exports","BaseChainSignatureContract","utils","signAndSend_exports","keypair_exports","BTCTransaction","CosmosTransaction","EVMTransaction","NEAR_MAX_GAS","BN","DONT_CARE_ACCOUNT_ID","getNearAccount","networkId","accountId","keypair","KeyPair","keyStore","InMemoryKeyStore","connection","Connection","Account","getRootPublicKey","contractAddress","environment","_","transaction_exports","mpcPayloadsToChainSigTransaction","responseToMpcSignature","sendTransactionUntil","contractId","currentContractFee","getTransactionLastResult","receiverId","actions","options","near","connect","signer","accessKey","recentBlockHash","nearUtils","transactions","nearTransactionSignature","signedTransaction","withRetry","txOutcome","rootPublicKey","sendTransactionOptions","account","Contract","najPubKey","deposit","result","actionCreators","req","evm","createPublicClient","http","signatures","cosmos"],"mappings":"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","file":"index.browser.cjs","sourcesContent":["import { type NajPublicKey } from '@types'\n\nexport const ENVS = {\n  TESTNET_DEV: 'TESTNET_DEV',\n  TESTNET: 'TESTNET',\n  MAINNET: 'MAINNET',\n} as const\n\n/**\n * Root public keys for the Sig Network Smart Contracts across different environments.\n *\n * These keys should never change.\n */\nexport const ROOT_PUBLIC_KEYS: Record<keyof typeof ENVS, NajPublicKey> = {\n  [ENVS.TESTNET_DEV]:\n    'secp256k1:54hU5wcCmVUPFWLDALXMh1fFToZsVXrx9BbTbHzSfQq1Kd1rJZi52iPa4QQxo6s5TgjWqgpY8HamYuUDzG6fAaUq',\n  [ENVS.TESTNET]:\n    'secp256k1:3Ww8iFjqTHufye5aRGUvrQqETegR4gVUcW8FX5xzscaN9ENhpkffojsxJwi6N1RbbHMTxYa9UyKeqK3fsMuwxjR5',\n  [ENVS.MAINNET]:\n    'secp256k1:4tY4qMzusmgX5wYdG35663Y3Qar3CTbpApotwk9ZKLoF79XA4DjG8XoByaKdNHKQX9Lz5hd7iJqsWdTKyA7dKa6Z',\n}\n\n/**\n * Chain ID used in the key derivation function (KDF) for deriving child public keys.\n *\n * @see {@link deriveChildPublicKey} in cryptography.ts for usage details\n */\nexport const KDF_CHAIN_ID = '0x18d' as const\n\n\n/**\n * Contract addresses for different chains and environments.\n *\n * - Testnet Dev: Used for internal development, very unstable\n * - Testnet: Used for external development, stable\n * - Mainnet: Production contract address\n *\n * @see ChainSignatureContract documentation for implementation details\n */\nexport const CONTRACT_ADDRESSES: Record<keyof typeof ENVS, string> = {\n    [ENVS.TESTNET_DEV]: 'dev.sig-net.testnet',\n    [ENVS.TESTNET]: 'v1.sig-net.testnet',\n    [ENVS.MAINNET]: 'v1.sig-net.near',\n}\n","export * as cryptography from './cryptography'\n","import { base58 } from '@scure/base'\nimport { ec as EC } from 'elliptic'\nimport { sha3_256 } from 'js-sha3'\nimport { keccak256 } from 'viem'\n\nimport { KDF_CHAIN_ID } from '@constants'\nimport {\n  type NajPublicKey,\n  type MPCSignature,\n  type RSVSignature,\n  type UncompressedPubKeySEC1,\n} from '@types'\n\nexport const toRSV = (signature: MPCSignature): RSVSignature => {\n  // Handle NearNearMpcSignature\n  if (\n    'big_r' in signature &&\n    typeof signature.big_r === 'object' &&\n    'affine_point' in signature.big_r &&\n    's' in signature &&\n    typeof signature.s === 'object' &&\n    'scalar' in signature.s\n  ) {\n    return {\n      r: signature.big_r.affine_point.substring(2),\n      s: signature.s.scalar,\n      v: signature.recovery_id + 27,\n    }\n  }\n  // Handle ChainSigNearMpcSignature\n  else if (\n    'big_r' in signature &&\n    typeof signature.big_r === 'string' &&\n    's' in signature &&\n    typeof signature.s === 'string'\n  ) {\n    return {\n      r: signature.big_r.substring(2),\n      s: signature.s,\n      v: signature.recovery_id + 27,\n    }\n  }\n  // Handle ChainSigEvmMpcSignature\n  else if (\n    'bigR' in signature &&\n    'x' in signature.bigR &&\n    's' in signature &&\n    typeof signature.s === 'bigint'\n  ) {\n    return {\n      r: signature.bigR.x.toString(16).padStart(64, '0'),\n      s: signature.s.toString(16).padStart(64, '0'),\n      v: signature.recoveryId + 27,\n    }\n  }\n\n  throw new Error('Invalid signature format')\n}\n\n/**\n * Compresses an uncompressed public key to its compressed format following SEC1 standards.\n * In SEC1, a compressed public key consists of a prefix (02 or 03) followed by the x-coordinate.\n * The prefix indicates whether the y-coordinate is even (02) or odd (03).\n *\n * @param uncompressedPubKeySEC1 - The uncompressed public key in hex format, with or without '04' prefix\n * @returns The compressed public key in hex format\n * @throws Error if the uncompressed public key length is invalid\n */\nexport const compressPubKey = (\n  uncompressedPubKeySEC1: UncompressedPubKeySEC1\n): string => {\n  const slicedPubKey = uncompressedPubKeySEC1.slice(2)\n\n  if (slicedPubKey.length !== 128) {\n    throw new Error('Invalid uncompressed public key length')\n  }\n\n  const x = slicedPubKey.slice(0, 64)\n  const y = slicedPubKey.slice(64)\n\n  const isEven = parseInt(y.slice(-1), 16) % 2 === 0\n  const prefix = isEven ? '02' : '03'\n\n  return prefix + x\n}\n\n/**\n * Converts a NAJ public key to an uncompressed SEC1 public key.\n *\n * @param najPublicKey - The NAJ public key to convert (e.g. secp256k1:3Ww8iFjqTHufye5aRGUvrQqETegR4gVUcW8FX5xzscaN9ENhpkffojsxJwi6N1RbbHMTxYa9UyKeqK3fsMuwxjR5)\n * @returns The uncompressed SEC1 public key (e.g. 04 || x || y)\n */\nexport const najToUncompressedPubKeySEC1 = (\n  najPublicKey: NajPublicKey\n): UncompressedPubKeySEC1 => {\n  const decodedKey = base58.decode(najPublicKey.split(':')[1])\n  return `04${Buffer.from(decodedKey).toString('hex')}`\n}\n\n/**\n * Derives a child public key from a parent public key using the sig.network v1.0.0 epsilon derivation scheme.\n * The parent public keys are defined in @constants.ts\n *\n * @param najPublicKey - The parent public key in uncompressed SEC1 format (e.g. 04 || x || y)\n * @param predecessorId - The predecessor ID is the address of the account calling the signer contract (e.g EOA or Contract Address)\n * @param path - Optional derivation path suffix (defaults to empty string)\n * @returns The derived child public key in uncompressed SEC1 format (04 || x || y)\n */\nexport function deriveChildPublicKey(\n  rootUncompressedPubKeySEC1: UncompressedPubKeySEC1,\n  predecessorId: string,\n  path: string = '',\n  chainId: string\n): UncompressedPubKeySEC1 {\n  const ec = new EC('secp256k1')\n\n  const EPSILON_DERIVATION_PREFIX = 'sig.network v1.0.0 epsilon derivation'\n  const derivationPath = `${EPSILON_DERIVATION_PREFIX},${chainId},${predecessorId},${path}`\n\n  let scalarHex = ''\n\n  if (chainId === KDF_CHAIN_ID) {\n    scalarHex = sha3_256(derivationPath)\n  } else {\n    throw new Error('Invalid chain ID')\n  }\n\n  const x = rootUncompressedPubKeySEC1.substring(2, 66)\n  const y = rootUncompressedPubKeySEC1.substring(66)\n\n  const oldPublicKeyPoint = ec.curve.point(x, y)\n  const scalarTimesG = ec.g.mul(scalarHex)\n  const newPublicKeyPoint = oldPublicKeyPoint.add(scalarTimesG)\n\n  const newX = newPublicKeyPoint.getX().toString('hex').padStart(64, '0')\n  const newY = newPublicKeyPoint.getY().toString('hex').padStart(64, '0')\n\n  return `04${newX}${newY}`\n}\n","export { ChainAdapter } from './ChainAdapter'\n\nexport * as evm from './EVM'\nexport * as btc from './Bitcoin'\nexport * as cosmos from './Cosmos'\nexport * as solana from './Solana'\n","import { type Transaction } from '@solana/web3.js'\n\nimport type { HashToSign, RSVSignature, Signature } from '@types'\n\nexport abstract class ChainAdapter<TransactionRequest, UnsignedTransaction> {\n  /**\n   * Gets the native token balance and decimals for a given address\n   *\n   * @param address - The address to check\n   * @returns Promise resolving to an object containing:\n   *          - balance: The balance as a bigint, in the chain's base units\n   *          - decimals: The number of decimals used to format the balance\n   */\n  abstract getBalance(address: string): Promise<{\n    balance: bigint\n    decimals: number\n  }>\n\n  /**\n   * Uses Sig Network Key Derivation Function to derive the address and public key. from a signer ID and string path.\n   *\n   * @param predecessor - The id/address of the account requesting signature\n   * @param path - The string path used to derive the key\n   * @returns Promise resolving to the derived address and public key\n   */\n  abstract deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{\n    address: string\n    publicKey: string\n  }>\n\n  /**\n   * Serializes an unsigned transaction to a string format.\n   * This is useful for storing or transmitting the transaction.\n   *\n   * @param transaction - The unsigned transaction to serialize\n   * @returns The serialized transaction string\n   */\n  abstract serializeTransaction(transaction: UnsignedTransaction): string\n\n  /**\n   * Deserializes a transaction string back into an unsigned transaction object.\n   * This reverses the serialization done by serializeTransaction().\n   *\n   * @param serialized - The serialized transaction string\n   * @returns The deserialized unsigned transaction\n   */\n  abstract deserializeTransaction(serialized: string): UnsignedTransaction\n\n  /**\n   * Prepares a transaction for Sig Network MPC signing by creating the necessary payloads.\n   * This method handles chain-specific transaction preparation including:\n   * - Fee calculation\n   * - Nonce/sequence management\n   * - UTXO selection (for UTXO-based chains)\n   * - Transaction encoding\n   *\n   * @param transactionRequest - The transaction request containing parameters like recipient, amount, etc.\n   * @returns Promise resolving to an object containing:\n   *          - transaction: The unsigned transaction\n   *          - hashesToSign: Array of payloads to be signed by MPC. The order of these payloads must match\n   *                         the order of signatures provided to finalizeTransactionSigning()\n   */\n  abstract prepareTransactionForSigning(\n    transactionRequest: TransactionRequest\n  ): Promise<{\n    transaction: UnsignedTransaction\n    hashesToSign: HashToSign[]\n  }>\n\n  /**\n   * Adds Sig Network MPC-generated signatures to an unsigned transaction.\n   *\n   * @param params - Parameters for adding signatures\n   * @param params.transaction - The unsigned transaction to add signatures to\n   * @param params.rsvSignatures - Array of RSV signatures generated through MPC. Must be in the same order\n   *                              as the payloads returned by prepareTransactionForSigning()\n   * @returns The serialized signed transaction ready for broadcast\n   */\n  abstract finalizeTransactionSigning(params: {\n    transaction: UnsignedTransaction | Transaction\n    rsvSignatures: RSVSignature[] | Signature\n  }): string\n\n  /**\n   * Broadcasts a signed transaction to the network.\n   *\n   * @param txSerialized - The serialized signed transaction\n   * @returns Promise resolving to an object containing the transaction hash/ID\n   */\n  abstract broadcastTx(txSerialized: string): Promise<{ hash: string }>\n}\n","// EVM\nexport { EVM } from './EVM'\n\nexport { fetchEVMFeeProperties } from './utils'\n\nexport type {\n  EVMTransactionRequest,\n  EVMUnsignedTransaction,\n  EVMMessage,\n  EVMTypedData,\n} from './types'\n","import {\n  parseTransaction,\n  type PublicClient,\n  hashMessage,\n  hashTypedData,\n  keccak256,\n  toBytes,\n  type Hex,\n  serializeTransaction,\n  type Signature,\n  numberToHex,\n  getAddress,\n  type Address,\n  type Hash,\n  concatHex,\n  encodeAbiParameters,\n  hexToBigInt,\n  concat,\n  pad,\n  isAddress,\n} from 'viem'\n\nimport { ChainAdapter } from '@chain-adapters/ChainAdapter'\nimport type {\n  EVMTransactionRequest,\n  EVMUnsignedTransaction,\n  EVMMessage,\n  EVMTypedData,\n  UserOperationV6,\n  UserOperationV7,\n} from '@chain-adapters/EVM/types'\nimport { fetchEVMFeeProperties } from '@chain-adapters/EVM/utils'\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, RSVSignature } from '@types'\n\n/**\n * Implementation of the ChainAdapter interface for EVM-compatible networks.\n * Handles interactions with Ethereum Virtual Machine based blockchains like Ethereum, BSC, Polygon, etc.\n */\nexport class EVM extends ChainAdapter<\n  EVMTransactionRequest,\n  EVMUnsignedTransaction\n> {\n  private readonly client: PublicClient\n  private readonly contract: BaseChainSignatureContract\n\n  /**\n   * Creates a new EVM chain instance\n   * @param params - Configuration parameters\n   * @param params.publicClient - A Viem PublicClient instance for reading from the blockchain\n   * @param params.contract - Instance of the chain signature contract for MPC operations\n   */\n  constructor({\n    publicClient,\n    contract,\n  }: {\n    publicClient: PublicClient\n    contract: BaseChainSignatureContract\n  }) {\n    super()\n\n    this.contract = contract\n    this.client = publicClient\n  }\n\n  private async attachGasAndNonce(\n    transaction: EVMTransactionRequest\n  ): Promise<EVMUnsignedTransaction> {\n    const fees = await fetchEVMFeeProperties(this.client, transaction)\n    const nonce = await this.client.getTransactionCount({\n      address: transaction.from,\n    })\n\n    const { from, ...rest } = transaction\n\n    return {\n      ...fees,\n      nonce,\n      chainId: Number(await this.client.getChainId()),\n      type: 'eip1559',\n      ...rest,\n    }\n  }\n\n  private transformRSVSignature(signature: RSVSignature): Signature {\n    return {\n      r: `0x${signature.r}`,\n      s: `0x${signature.s}`,\n      yParity: signature.v - 27,\n    }\n  }\n\n  private assembleSignature(signature: RSVSignature): Hex {\n    const { r, s, yParity } = this.transformRSVSignature(signature)\n\n    if (yParity === undefined) {\n      throw new Error('Missing yParity')\n    }\n\n    return concatHex([r, s, numberToHex(yParity + 27, { size: 1 })])\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{\n    address: string\n    publicKey: string\n  }> {\n    const uncompressedPubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n    })\n\n    if (!uncompressedPubKey) {\n      throw new Error('Failed to get derived public key')\n    }\n\n    const publicKeyNoPrefix = uncompressedPubKey.startsWith('04')\n      ? uncompressedPubKey.slice(2)\n      : uncompressedPubKey\n\n    const hash = keccak256(Buffer.from(publicKeyNoPrefix, 'hex'))\n    const address = getAddress(`0x${hash.slice(-40)}`)\n\n    return {\n      address,\n      publicKey: uncompressedPubKey,\n    }\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    const balance = await this.client.getBalance({\n      address: address as Address,\n    })\n    return {\n      balance,\n      decimals: 18,\n    }\n  }\n\n  serializeTransaction(transaction: EVMUnsignedTransaction): `0x${string}` {\n    return serializeTransaction(transaction)\n  }\n\n  deserializeTransaction(serialized: `0x${string}`): EVMUnsignedTransaction {\n    return parseTransaction(serialized) as EVMUnsignedTransaction\n  }\n\n  async prepareTransactionForSigning(\n    transactionRequest: EVMTransactionRequest\n  ): Promise<{\n    transaction: EVMUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const transaction = await this.attachGasAndNonce(transactionRequest)\n\n    const serializedTx = serializeTransaction(transaction)\n    const txHash = toBytes(keccak256(serializedTx))\n\n    return {\n      transaction,\n      hashesToSign: [Array.from(txHash)],\n    }\n  }\n\n  async prepareMessageForSigning(message: EVMMessage): Promise<{\n    hashToSign: HashToSign\n  }> {\n    return {\n      hashToSign: Array.from(toBytes(hashMessage(message))),\n    }\n  }\n\n  async prepareTypedDataForSigning(typedDataRequest: EVMTypedData): Promise<{\n    hashToSign: HashToSign\n  }> {\n    return {\n      hashToSign: Array.from(toBytes(hashTypedData(typedDataRequest))),\n    }\n  }\n\n  /**\n   * This implementation is a common step for Biconomy and Alchemy.\n   * Key differences between implementations:\n   * - Signature format: Biconomy omits 0x00 prefix when concatenating, Alchemy includes it\n   * - Version support: Biconomy only supports v6, Alchemy supports both v6 and v7\n   * - Validation: Biconomy uses modules for signature validation, Alchemy uses built-in validation\n   */\n  async prepareUserOpForSigning(\n    userOp: UserOperationV7 | UserOperationV6,\n    entryPointAddress?: Address,\n    chainIdArgs?: number\n  ): Promise<{\n    userOp: UserOperationV7 | UserOperationV6\n    hashToSign: HashToSign\n  }> {\n    const chainId = chainIdArgs ?? (await this.client.getChainId())\n    const entryPoint =\n      entryPointAddress || '0x0000000071727De22E5E9d8BAf0edAc6f37da032'\n\n    const encoded = encodeAbiParameters(\n      [{ type: 'bytes32' }, { type: 'address' }, { type: 'uint256' }],\n      [\n        keccak256(\n          encodeAbiParameters(\n            [\n              { type: 'address' },\n              { type: 'uint256' },\n              { type: 'bytes32' },\n              { type: 'bytes32' },\n              { type: 'bytes32' },\n              { type: 'uint256' },\n              { type: 'bytes32' },\n              { type: 'bytes32' },\n            ],\n            [\n              userOp.sender,\n              hexToBigInt(userOp.nonce),\n              keccak256(\n                'factory' in userOp &&\n                  'factoryData' in userOp &&\n                  userOp.factory &&\n                  userOp.factoryData\n                  ? concat([userOp.factory, userOp.factoryData])\n                  : 'initCode' in userOp\n                    ? userOp.initCode\n                    : '0x'\n              ),\n              keccak256(userOp.callData),\n              concat([\n                pad(userOp.verificationGasLimit, { size: 16 }),\n                pad(userOp.callGasLimit, { size: 16 }),\n              ]),\n              hexToBigInt(userOp.preVerificationGas),\n              concat([\n                pad(userOp.maxPriorityFeePerGas, { size: 16 }),\n                pad(userOp.maxFeePerGas, { size: 16 }),\n              ]),\n              keccak256(\n                'paymaster' in userOp &&\n                  userOp.paymaster &&\n                  isAddress(userOp.paymaster)\n                  ? concat([\n                    userOp.paymaster,\n                    pad(userOp.paymasterVerificationGasLimit, { size: 16 }),\n                    pad(userOp.paymasterPostOpGasLimit, { size: 16 }),\n                    userOp.paymasterData,\n                  ])\n                  : 'paymasterAndData' in userOp\n                    ? userOp.paymasterAndData\n                    : '0x'\n              ),\n            ]\n          )\n        ),\n        entryPoint,\n        BigInt(chainId),\n      ]\n    )\n\n    const userOpHash = keccak256(encoded)\n\n    return {\n      userOp,\n      hashToSign: Array.from(toBytes(hashMessage({ raw: userOpHash }))),\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction,\n    rsvSignatures,\n  }: {\n    transaction: EVMUnsignedTransaction\n    rsvSignatures: RSVSignature[]\n  }): `0x02${string}` {\n    const signature = this.transformRSVSignature(rsvSignatures[0])\n\n    return serializeTransaction(transaction, signature)\n  }\n\n  finalizeMessageSigning({\n    rsvSignature,\n  }: {\n    rsvSignature: RSVSignature\n  }): Hex {\n    return this.assembleSignature(rsvSignature)\n  }\n\n  finalizeTypedDataSigning({\n    rsvSignature,\n  }: {\n    rsvSignature: RSVSignature\n  }): Hex {\n    return this.assembleSignature(rsvSignature)\n  }\n\n  finalizeUserOpSigning({\n    userOp,\n    rsvSignature,\n  }: {\n    userOp: UserOperationV7 | UserOperationV6\n    rsvSignature: RSVSignature\n  }): UserOperationV7 | UserOperationV6 {\n    const { r, s, yParity } = this.transformRSVSignature(rsvSignature)\n    if (yParity === undefined) {\n      throw new Error('Missing yParity')\n    }\n\n    return {\n      ...userOp,\n      signature: concatHex([\n        '0x00', // Alchemy specific implementation. Biconomy doesn't include the 0x00 prefix.\n        r,\n        s,\n        numberToHex(Number(yParity + 27), { size: 1 }),\n      ]),\n    }\n  }\n\n  async broadcastTx(txSerialized: string): Promise<{ hash: Hash }> {\n    try {\n      const hash = await this.client.sendRawTransaction({\n        serializedTransaction: txSerialized as `0x${string}`,\n      })\n      return { hash: hash }\n    } catch (error) {\n      console.error('Transaction broadcast failed:', error)\n      throw new Error('Failed to broadcast transaction.')\n    }\n  }\n}\n","import { type PublicClient, type TransactionRequest } from 'viem'\n\nexport interface EVMFeeProperties {\n  gas: bigint\n  maxFeePerGas: bigint\n  maxPriorityFeePerGas: bigint\n}\n\nexport async function fetchEVMFeeProperties(\n  client: PublicClient,\n  transaction: TransactionRequest\n): Promise<EVMFeeProperties> {\n  const [gas, feeData] = await Promise.all([\n    client.estimateGas(transaction),\n    client.estimateFeesPerGas(),\n  ])\n\n  const maxFeePerGas = feeData.maxFeePerGas ?? BigInt(10_000_000_000) // 10 gwei\n  const maxPriorityFeePerGas =\n    feeData.maxPriorityFeePerGas ?? BigInt(10_000_000_000) // 10 gwei\n\n  return {\n    gas,\n    maxFeePerGas,\n    maxPriorityFeePerGas,\n  }\n}\n","// Bitcoin\nexport { Bitcoin } from './Bitcoin'\n\nexport { BTCRpcAdapters, BTCRpcAdapter } from './BTCRpcAdapter'\n\nexport type {\n  BTCTransactionRequest,\n  BTCUnsignedTransaction,\n  BTCTransaction,\n  BTCOutput,\n  BTCInput,\n  BTCNetworkIds,\n} from './types'\n","import * as bitcoin from 'bitcoinjs-lib'\n\nimport { type BTCRpcAdapter } from '@chain-adapters/Bitcoin/BTCRpcAdapter'\nimport type {\n  BTCInput,\n  BTCNetworkIds,\n  BTCOutput,\n  BTCTransactionRequest,\n  BTCUnsignedTransaction,\n} from '@chain-adapters/Bitcoin/types'\nimport { parseBTCNetwork } from '@chain-adapters/Bitcoin/utils'\nimport { ChainAdapter } from '@chain-adapters/ChainAdapter'\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, RSVSignature, UncompressedPubKeySEC1 } from '@types'\nimport { cryptography } from '@utils'\n\n/**\n * Implementation of the ChainAdapter interface for Bitcoin network.\n * Handles interactions with both Bitcoin mainnet and testnet, supporting P2WPKH transactions.\n */\nexport class Bitcoin extends ChainAdapter<\n  BTCTransactionRequest,\n  BTCUnsignedTransaction\n> {\n  private static readonly SATOSHIS_PER_BTC = 100_000_000\n\n  private readonly network: BTCNetworkIds\n  private readonly btcRpcAdapter: BTCRpcAdapter\n  private readonly contract: BaseChainSignatureContract\n\n  /**\n   * Creates a new Bitcoin chain instance\n   * @param params - Configuration parameters\n   * @param params.network - Network identifier (mainnet/testnet)\n   * @param params.contract - Instance of the chain signature contract for MPC operations\n   * @param params.btcRpcAdapter - Bitcoin RPC adapter for network interactions\n   */\n  constructor({\n    network,\n    contract,\n    btcRpcAdapter,\n  }: {\n    network: BTCNetworkIds\n    contract: BaseChainSignatureContract\n    btcRpcAdapter: BTCRpcAdapter\n  }) {\n    super()\n\n    this.network = network\n    this.btcRpcAdapter = btcRpcAdapter\n    this.contract = contract\n  }\n\n  /**\n   * Converts satoshis to BTC\n   * @param satoshis - Amount in satoshis\n   * @returns Amount in BTC\n   */\n  static toBTC(satoshis: number): number {\n    return satoshis / Bitcoin.SATOSHIS_PER_BTC\n  }\n\n  /**\n   * Converts BTC to satoshis\n   * @param btc - Amount in BTC\n   * @returns Amount in satoshis (rounded)\n   */\n  static toSatoshi(btc: number): number {\n    return Math.round(btc * Bitcoin.SATOSHIS_PER_BTC)\n  }\n\n  private async fetchTransaction(\n    transactionId: string\n  ): Promise<bitcoin.Transaction> {\n    const data = await this.btcRpcAdapter.getTransaction(transactionId)\n    const tx = new bitcoin.Transaction()\n\n    data.vout.forEach((vout) => {\n      const scriptPubKey = Buffer.from(vout.scriptpubkey, 'hex')\n      tx.addOutput(scriptPubKey, Number(vout.value))\n    })\n\n    return tx\n  }\n\n  private static transformRSVSignature(signature: RSVSignature): Buffer {\n    const r = signature.r.padStart(64, '0')\n    const s = signature.s.padStart(64, '0')\n\n    const rawSignature = Buffer.from(r + s, 'hex')\n\n    if (rawSignature.length !== 64) {\n      throw new Error('Invalid signature length.')\n    }\n\n    return rawSignature\n  }\n\n  /**\n   * Creates a Partially Signed Bitcoin Transaction (PSBT)\n   * @param params - Parameters for creating the PSBT\n   * @param params.transactionRequest - Transaction request containing inputs and outputs\n   * @returns Created PSBT instance\n   */\n  async createPSBT({\n    transactionRequest,\n  }: {\n    transactionRequest: BTCTransactionRequest\n  }): Promise<bitcoin.Psbt> {\n    const { inputs, outputs } =\n      transactionRequest.inputs && transactionRequest.outputs\n        ? transactionRequest\n        : await this.btcRpcAdapter.selectUTXOs(transactionRequest.from, [\n            {\n              address: transactionRequest.to,\n              value: parseFloat(transactionRequest.value),\n            },\n          ])\n\n    const psbt = new bitcoin.Psbt({ network: parseBTCNetwork(this.network) })\n\n    await Promise.all(\n      inputs.map(async (input: BTCInput) => {\n        if (!input.scriptPubKey) {\n          const transaction = await this.fetchTransaction(input.txid)\n          const prevOut = transaction.outs[input.vout]\n          input.scriptPubKey = prevOut.script\n        }\n\n        // Prepare the input as P2WPKH\n        psbt.addInput({\n          hash: input.txid,\n          index: input.vout,\n          witnessUtxo: {\n            script: input.scriptPubKey,\n            value: input.value,\n          },\n        })\n      })\n    )\n\n    outputs.forEach((out: BTCOutput) => {\n      if ('address' in out) {\n        psbt.addOutput({\n          address: out.address,\n          value: out.value,\n        })\n      } else if ('script' in out) {\n        psbt.addOutput({\n          script: out.script,\n          value: out.value,\n        })\n      } else if (transactionRequest.from !== undefined) {\n        // Include change address from coinselect\n        psbt.addOutput({\n          value: Number(out.value),\n          address: transactionRequest.from,\n        })\n      }\n    })\n\n    return psbt\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    const balance = BigInt(await this.btcRpcAdapter.getBalance(address))\n    return {\n      balance,\n      decimals: 8,\n    }\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{ address: string; publicKey: string }> {\n    const uncompressedPubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n    })\n\n    if (!uncompressedPubKey) {\n      throw new Error('Failed to get derived public key')\n    }\n\n    const derivedKey = cryptography.compressPubKey(\n      uncompressedPubKey as UncompressedPubKeySEC1\n    )\n    const publicKeyBuffer = Buffer.from(derivedKey, 'hex')\n    const network = parseBTCNetwork(this.network)\n\n    const payment = bitcoin.payments.p2wpkh({\n      pubkey: publicKeyBuffer,\n      network,\n    })\n\n    const { address } = payment\n\n    if (!address) {\n      throw new Error('Failed to generate Bitcoin address')\n    }\n\n    return { address, publicKey: derivedKey }\n  }\n\n  serializeTransaction(transaction: BTCUnsignedTransaction): string {\n    return JSON.stringify({\n      psbt: transaction.psbt.toHex(),\n      publicKey: transaction.publicKey,\n    })\n  }\n\n  deserializeTransaction(serialized: string): BTCUnsignedTransaction {\n    const transactionJSON = JSON.parse(serialized)\n    return {\n      psbt: bitcoin.Psbt.fromHex(transactionJSON.psbt as string),\n      publicKey: transactionJSON.publicKey,\n    }\n  }\n\n  async prepareTransactionForSigning(\n    transactionRequest: BTCTransactionRequest\n  ): Promise<{\n    transaction: BTCUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const publicKeyBuffer = Buffer.from(transactionRequest.publicKey, 'hex')\n    const psbt = await this.createPSBT({\n      transactionRequest,\n    })\n\n    // We can't double sign a PSBT, therefore we serialize the payload before to return it\n    const psbtHex = psbt.toHex()\n\n    const hashesToSign: HashToSign[] = []\n\n    const mockKeyPair = (index: number): bitcoin.Signer => ({\n      publicKey: publicKeyBuffer,\n      sign: (hash: Buffer): Buffer => {\n        hashesToSign[index] = Array.from(hash)\n        // Return dummy signature to satisfy the interface\n        return Buffer.alloc(64)\n      },\n    })\n\n    for (let index = 0; index < psbt.inputCount; index++) {\n      psbt.signInput(index, mockKeyPair(index))\n    }\n\n    return {\n      transaction: {\n        psbt: bitcoin.Psbt.fromHex(psbtHex),\n        publicKey: transactionRequest.publicKey,\n      },\n      hashesToSign,\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction: { psbt, publicKey },\n    rsvSignatures,\n  }: {\n    transaction: BTCUnsignedTransaction\n    rsvSignatures: RSVSignature[]\n  }): string {\n    const publicKeyBuffer = Buffer.from(publicKey, 'hex')\n\n    const keyPair = (index: number): bitcoin.Signer => ({\n      publicKey: publicKeyBuffer,\n      sign: () => {\n        const mpcSignature = rsvSignatures[index]\n        return Bitcoin.transformRSVSignature(mpcSignature)\n      },\n    })\n\n    for (let index = 0; index < psbt.inputCount; index++) {\n      psbt.signInput(index, keyPair(index))\n    }\n\n    psbt.finalizeAllInputs()\n    return psbt.extractTransaction().toHex()\n  }\n\n  async broadcastTx(txSerialized: string): Promise<{ hash: string }> {\n    const txId = await this.btcRpcAdapter.broadcastTransaction(txSerialized)\n    return { hash: txId }\n  }\n}\n","import * as bitcoin from 'bitcoinjs-lib'\n\nexport function parseBTCNetwork(network: string): bitcoin.networks.Network {\n  switch (network.toLowerCase()) {\n    case 'mainnet':\n      return bitcoin.networks.bitcoin\n    case 'testnet':\n      return bitcoin.networks.testnet\n    case 'regtest':\n      return bitcoin.networks.regtest\n    default:\n      throw new Error(`Unknown Bitcoin network: ${network}`)\n  }\n}\n","// There is no types for coinselect\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-expect-error\n\nimport coinselect from 'coinselect'\n\nimport { BTCRpcAdapter } from '@chain-adapters/Bitcoin/BTCRpcAdapter/BTCRpcAdapter'\nimport {\n  type BTCFeeRecommendation,\n  type UTXO,\n} from '@chain-adapters/Bitcoin/BTCRpcAdapter/Mempool/types'\nimport type {\n  BTCTransaction,\n  BTCInput,\n  BTCOutput,\n} from '@chain-adapters/Bitcoin/types'\n\nexport class Mempool extends BTCRpcAdapter {\n  private readonly providerUrl: string\n\n  constructor(providerUrl: string) {\n    super()\n    this.providerUrl = providerUrl\n  }\n\n  private async fetchFeeRate(confirmationTarget = 6): Promise<number> {\n    const response = await fetch(`${this.providerUrl}/v1/fees/recommended`)\n    const data = (await response.json()) as BTCFeeRecommendation\n\n    if (confirmationTarget <= 1) {\n      return data.fastestFee\n    } else if (confirmationTarget <= 3) {\n      return data.halfHourFee\n    } else if (confirmationTarget <= 6) {\n      return data.hourFee\n    } else {\n      return data.economyFee\n    }\n  }\n\n  private async fetchUTXOs(address: string): Promise<UTXO[]> {\n    try {\n      const response = await fetch(\n        `${this.providerUrl}/address/${address}/utxo`\n      )\n      return (await response.json()) as UTXO[]\n    } catch (error) {\n      console.error('Failed to fetch UTXOs:', error)\n      return []\n    }\n  }\n\n  async selectUTXOs(\n    from: string,\n    targets: BTCOutput[],\n    confirmationTarget = 6\n  ): Promise<{ inputs: BTCInput[]; outputs: BTCOutput[] }> {\n    const utxos = await this.fetchUTXOs(from)\n    const feeRate = await this.fetchFeeRate(confirmationTarget)\n\n    // Add a small amount to the fee rate to ensure the transaction is confirmed\n    const ret = coinselect(utxos, targets, Math.ceil(feeRate + 1))\n\n    if (!ret.inputs || !ret.outputs) {\n      throw new Error(\n        'Invalid transaction: coinselect failed to find a suitable set of inputs and outputs. This could be due to insufficient funds, or no inputs being available that meet the criteria.'\n      )\n    }\n\n    return {\n      inputs: ret.inputs,\n      outputs: ret.outputs,\n    }\n  }\n\n  async broadcastTransaction(transactionHex: string): Promise<string> {\n    const response = await fetch(`${this.providerUrl}/tx`, {\n      method: 'POST',\n      body: transactionHex,\n    })\n\n    if (response.ok) {\n      return await response.text()\n    }\n\n    throw new Error(`Failed to broadcast transaction: ${await response.text()}`)\n  }\n\n  async getBalance(address: string): Promise<number> {\n    const response = await fetch(`${this.providerUrl}/address/${address}`)\n    const data = (await response.json()) as {\n      chain_stats: { funded_txo_sum: number; spent_txo_sum: number }\n    }\n    return data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum\n  }\n\n  async getTransaction(txid: string): Promise<BTCTransaction> {\n    const response = await fetch(`${this.providerUrl}/tx/${txid}`)\n    return (await response.json()) as BTCTransaction\n  }\n}\n","import type {\n  BTCTransaction,\n  BTCInput,\n  BTCOutput,\n} from '@chain-adapters/Bitcoin/types'\n\nexport abstract class BTCRpcAdapter {\n  abstract selectUTXOs(\n    from: string,\n    targets: BTCOutput[]\n  ): Promise<{ inputs: BTCInput[]; outputs: BTCOutput[] }>\n  abstract broadcastTransaction(transactionHex: string): Promise<string>\n  abstract getBalance(address: string): Promise<number>\n  abstract getTransaction(txid: string): Promise<BTCTransaction>\n}\n","import { Mempool } from './Mempool'\nexport { BTCRpcAdapter } from './BTCRpcAdapter'\n\nexport const BTCRpcAdapters = {\n  Mempool,\n}\n","// Cosmos\nexport { Cosmos } from './Cosmos'\n\nexport type {\n  CosmosNetworkIds,\n  CosmosTransactionRequest,\n  CosmosUnsignedTransaction,\n} from './types'\n","import { chains, assets } from 'chain-registry'\n\nimport { type ChainInfo } from '@chain-adapters/Cosmos/types'\n\nexport const fetchChainInfo = async (chainId: string): Promise<ChainInfo> => {\n  const chainInfo = chains.find((chain) => chain.chain_id === chainId)\n  if (!chainInfo) {\n    throw new Error(`Chain info not found for chainId: ${chainId}`)\n  }\n\n  const { bech32_prefix: prefix, chain_id: expectedChainId } = chainInfo\n  const denom = chainInfo.staking?.staking_tokens?.[0]?.denom\n  const rpcUrl = chainInfo.apis?.rpc?.[0]?.address\n  const restUrl = chainInfo.apis?.rest?.[0]?.address\n  const gasPrice = chainInfo.fees?.fee_tokens?.[0]?.average_gas_price\n\n  if (\n    !prefix ||\n    !denom ||\n    !rpcUrl ||\n    !restUrl ||\n    !expectedChainId ||\n    gasPrice === undefined\n  ) {\n    throw new Error(\n      `Missing required chain information for ${chainInfo.chain_name}`\n    )\n  }\n\n  const assetList = assets.find(\n    (asset) => asset.chain_name === chainInfo.chain_name\n  )\n  const asset = assetList?.assets.find((asset) => asset.base === denom)\n  const decimals = asset?.denom_units.find(\n    (unit) => unit.denom === asset.display\n  )?.exponent\n\n  if (decimals === undefined) {\n    throw new Error(\n      `Could not find decimals for ${denom} on chain ${chainInfo.chain_name}`\n    )\n  }\n\n  return { prefix, denom, rpcUrl, restUrl, expectedChainId, gasPrice, decimals }\n}\n","import { encodeSecp256k1Pubkey } from '@cosmjs/amino'\nimport { ripemd160, sha256 } from '@cosmjs/crypto'\nimport { toBase64, fromBase64, fromHex } from '@cosmjs/encoding'\nimport {\n  Registry,\n  makeSignBytes,\n  encodePubkey,\n  makeAuthInfoBytes,\n  makeSignDoc,\n  type TxBodyEncodeObject,\n} from '@cosmjs/proto-signing'\nimport { GasPrice, StargateClient, calculateFee } from '@cosmjs/stargate'\nimport { bech32 } from 'bech32'\nimport { SignMode } from 'cosmjs-types/cosmos/tx/signing/v1beta1/signing'\nimport { TxRaw } from 'cosmjs-types/cosmos/tx/v1beta1/tx'\n\nimport { ChainAdapter } from '@chain-adapters/ChainAdapter'\nimport type {\n  CosmosNetworkIds,\n  CosmosTransactionRequest,\n  CosmosUnsignedTransaction,\n  ChainInfo,\n  BalanceResponse,\n} from '@chain-adapters/Cosmos/types'\nimport { fetchChainInfo } from '@chain-adapters/Cosmos/utils'\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, RSVSignature, UncompressedPubKeySEC1 } from '@types'\nimport { cryptography } from '@utils'\n\n/**\n * Implementation of the ChainAdapter interface for Cosmos-based networks.\n * Handles interactions with Cosmos SDK chains like Cosmos Hub, Osmosis, etc.\n */\nexport class Cosmos extends ChainAdapter<\n  CosmosTransactionRequest,\n  CosmosUnsignedTransaction\n> {\n  private readonly registry: Registry\n  private readonly chainId: CosmosNetworkIds\n  private readonly contract: BaseChainSignatureContract\n  private readonly endpoints?: {\n    rpcUrl?: string\n    restUrl?: string\n  }\n\n  /**\n   * Creates a new Cosmos chain instance\n   * @param params - Configuration parameters\n   * @param params.chainId - Chain id for the Cosmos network\n   * @param params.contract - Instance of the chain signature contract for MPC operations\n   * @param params.endpoints - Optional RPC and REST endpoints\n   * @param params.endpoints.rpcUrl - Optional RPC endpoint URL\n   * @param params.endpoints.restUrl - Optional REST endpoint URL\n   */\n  constructor({\n    chainId,\n    contract,\n    endpoints,\n  }: {\n    contract: BaseChainSignatureContract\n    chainId: CosmosNetworkIds\n    endpoints?: {\n      rpcUrl?: string\n      restUrl?: string\n    }\n  }) {\n    super()\n\n    this.contract = contract\n    this.registry = new Registry()\n    this.chainId = chainId\n    this.endpoints = endpoints\n  }\n\n  private transformRSVSignature(rsvSignature: RSVSignature): Uint8Array {\n    return new Uint8Array([\n      ...fromHex(rsvSignature.r),\n      ...fromHex(rsvSignature.s),\n    ])\n  }\n\n  private async getChainInfo(): Promise<ChainInfo> {\n    return {\n      ...(await fetchChainInfo(this.chainId)),\n      ...this.endpoints,\n    }\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    try {\n      const { restUrl, denom, decimals } = await this.getChainInfo()\n\n      const response = await fetch(\n        `${restUrl}/cosmos/bank/v1beta1/balances/${address}`\n      )\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`)\n      }\n\n      const data = (await response.json()) as BalanceResponse\n      const balance = data.balances.find((b) => b.denom === denom)\n      const amount = balance?.amount ?? '0'\n\n      return {\n        balance: BigInt(amount),\n        decimals,\n      }\n    } catch (error) {\n      console.error('Failed to fetch Cosmos balance:', error)\n      throw new Error('Failed to fetch Cosmos balance')\n    }\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{\n    address: string\n    publicKey: string\n  }> {\n    const { prefix } = await this.getChainInfo()\n    const uncompressedPubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n    })\n\n    if (!uncompressedPubKey) {\n      throw new Error('Failed to get derived public key')\n    }\n\n    const derivedKey = cryptography.compressPubKey(\n      uncompressedPubKey as UncompressedPubKeySEC1\n    )\n    const pubKeySha256 = sha256(fromHex(derivedKey))\n    const ripemd160Hash = ripemd160(pubKeySha256)\n    const address = bech32.encode(prefix, bech32.toWords(ripemd160Hash))\n\n    return { address, publicKey: derivedKey }\n  }\n\n  serializeTransaction(transaction: CosmosUnsignedTransaction): string {\n    const serialized = TxRaw.encode(transaction).finish()\n    return toBase64(serialized)\n  }\n\n  deserializeTransaction(serialized: string): CosmosUnsignedTransaction {\n    return TxRaw.decode(fromBase64(serialized))\n  }\n\n  async prepareTransactionForSigning(\n    transactionRequest: CosmosTransactionRequest\n  ): Promise<{\n    transaction: CosmosUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const { denom, rpcUrl, gasPrice } = await this.getChainInfo()\n    const publicKeyBytes = fromHex(transactionRequest.publicKey)\n\n    const gasLimit = transactionRequest.gas || 200_000\n\n    const fee = calculateFee(\n      gasLimit,\n      GasPrice.fromString(`${gasPrice}${denom}`)\n    )\n\n    const client = await StargateClient.connect(rpcUrl)\n    const accountOnChain = await client.getAccount(transactionRequest.address)\n    if (!accountOnChain) {\n      throw new Error(\n        `Account ${transactionRequest.address} does not exist on chain`\n      )\n    }\n\n    const { accountNumber, sequence } = accountOnChain\n\n    const txBodyEncodeObject: TxBodyEncodeObject = {\n      typeUrl: '/cosmos.tx.v1beta1.TxBody',\n      value: {\n        messages: transactionRequest.messages,\n        memo: transactionRequest.memo || '',\n      },\n    }\n\n    const txBodyBytes = this.registry.encode(txBodyEncodeObject)\n\n    const pubkey = encodePubkey(encodeSecp256k1Pubkey(publicKeyBytes))\n\n    // TODO: Allow caller to provide: multiple signers, fee payer, fee granter\n    const authInfoBytes = makeAuthInfoBytes(\n      [\n        {\n          pubkey,\n          sequence,\n        },\n      ],\n      fee.amount,\n      Number(fee.gas),\n      undefined,\n      undefined,\n      SignMode.SIGN_MODE_DIRECT\n    )\n\n    const signDoc = makeSignDoc(\n      txBodyBytes,\n      authInfoBytes,\n      this.chainId,\n      accountNumber\n    )\n\n    const signBytes = makeSignBytes(signDoc)\n    const payload = Array.from(sha256(signBytes))\n\n    return {\n      transaction: TxRaw.fromPartial({\n        bodyBytes: txBodyBytes,\n        authInfoBytes,\n        signatures: [],\n      }),\n      hashesToSign: [payload],\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction,\n    rsvSignatures,\n  }: {\n    transaction: CosmosUnsignedTransaction\n    rsvSignatures: RSVSignature[]\n  }): string {\n    // Allow support for multi-sig but the package only supports single-sig\n    transaction.signatures = rsvSignatures.map((sig) =>\n      this.transformRSVSignature(sig)\n    )\n\n    const txBytes = TxRaw.encode(transaction).finish()\n    return Buffer.from(txBytes).toString('hex')\n  }\n\n  // @ts-expect-error - TODO: fix this\n  async broadcastTx(txSerialized: string): Promise<string> {\n    try {\n      const { rpcUrl } = await this.getChainInfo()\n      const client = await StargateClient.connect(rpcUrl)\n\n      const txBytes = fromHex(txSerialized)\n      const broadcastResponse = await client.broadcastTx(txBytes)\n\n      if (broadcastResponse.code !== 0) {\n        throw new Error(`Broadcast error: ${broadcastResponse.rawLog}`)\n      }\n\n      return broadcastResponse.transactionHash\n    } catch (error) {\n      console.error('Transaction broadcast failed:', error)\n      throw new Error('Failed to broadcast transaction.')\n    }\n  }\n}\n","export * from './Solana'\nexport * from './types'\n","import type { Connection as SolanaConnection } from '@solana/web3.js'\nimport { PublicKey, Transaction, SystemProgram } from '@solana/web3.js'\nimport type BN from 'bn.js'\n\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, Signature } from '@types'\n\nimport { ChainAdapter } from '../ChainAdapter'\n\nimport type {\n  SolanaTransactionRequest,\n  SolanaUnsignedTransaction,\n} from './types'\n\nconst toBigInt = (value: bigint | BN): bigint => {\n  if (typeof value === 'bigint') return value\n  return BigInt(value.toString())\n}\n\nexport class Solana extends ChainAdapter<\n  SolanaTransactionRequest,\n  SolanaUnsignedTransaction\n> {\n  private readonly connection: SolanaConnection\n  private readonly contract: BaseChainSignatureContract\n\n  constructor(args: {\n    solanaConnection: SolanaConnection\n    contract: BaseChainSignatureContract\n  }) {\n    super()\n    this.connection = args.solanaConnection\n    this.contract = args.contract\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    const pubkey = new PublicKey(address)\n    const balance = await this.connection.getBalance(pubkey)\n    return {\n      balance: BigInt(balance),\n      decimals: 9, // Solana uses 9 decimals (LAMPORTS_PER_SOL)\n    }\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{ address: string; publicKey: string }> {\n    const pubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n      IsEd25519: true,\n    })\n\n    const base58Key = pubKey.replace('ed25519:', '')\n    const publicKey = new PublicKey(base58Key)\n\n    return {\n      address: publicKey.toBase58(),\n      publicKey: publicKey.toString(),\n    }\n  }\n\n  serializeTransaction(transaction: SolanaUnsignedTransaction): string {\n    return Buffer.from(\n      transaction.transaction.serialize({\n        requireAllSignatures: false,\n      })\n    ).toString('base64')\n  }\n\n  deserializeTransaction(serialized: string): SolanaUnsignedTransaction {\n    const buffer = Buffer.from(serialized, 'base64')\n    const transaction = Transaction.from(buffer)\n\n    return {\n      transaction,\n      feePayer:\n        transaction.feePayer ||\n        new PublicKey('11111111111111111111111111111111'),\n      recentBlockhash: transaction.recentBlockhash || '',\n    }\n  }\n\n  async prepareTransactionForSigning(\n    request: SolanaTransactionRequest\n  ): Promise<{\n    transaction: SolanaUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const transaction = new Transaction()\n\n    // Add transfer instruction if amount is specified\n    const amount = toBigInt(request.amount)\n    if (amount > 0n) {\n      transaction.add(\n        SystemProgram.transfer({\n          fromPubkey: new PublicKey(request.from),\n          toPubkey: new PublicKey(request.to),\n          lamports: Number(amount),\n        })\n      )\n    }\n\n    // Add any additional instructions\n    if (request.instructions) {\n      transaction.add(...request.instructions)\n    }\n\n    // Get recent blockhash\n    const { blockhash } = await this.connection.getLatestBlockhash()\n    transaction.recentBlockhash = blockhash\n\n    // Set fee payer\n    transaction.feePayer = request.feePayer || new PublicKey(request.from)\n\n    const messageBytes = transaction.compileMessage().serialize()\n\n    return {\n      transaction: {\n        transaction,\n        feePayer: transaction.feePayer,\n        recentBlockhash: blockhash,\n      },\n      hashesToSign: [Array.from(messageBytes)],\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction,\n    rsvSignatures,\n    senderAddress,\n  }: {\n    transaction: Transaction\n    rsvSignatures: Signature\n    senderAddress: string\n  }): string {\n    const signatureBuffer = Buffer.from(rsvSignatures.signature)\n    transaction.addSignature(new PublicKey(senderAddress), signatureBuffer)\n    return transaction.serialize().toString('base64')\n  }\n\n  async broadcastTx(txSerialized: string): Promise<{ hash: string }> {\n    const transaction = this.deserializeTransaction(txSerialized)\n\n    const signature = await this.connection.sendRawTransaction(\n      transaction.transaction.serialize()\n    )\n\n    return { hash: signature }\n  }\n}\n","export { ChainSignatureContract, type SignArgs } from './ChainSignatureContract'\n\nexport * as near from './near'","import type BN from 'bn.js'\n\nimport type {\n  RSVSignature,\n  UncompressedPubKeySEC1,\n  Ed25519PubKey,\n  DerivedPublicKeyArgs,\n} from '../types'\n\nexport interface ArgsEd25519 extends DerivedPublicKeyArgs {\n  IsEd25519: boolean\n}\n\nexport interface SignArgs {\n  /** The payload to sign as an array of 32 bytes */\n  payload: number[]\n  /** The derivation path for key generation */\n  path: string\n  /** Version of the key to use */\n  key_version: number\n}\n\n/**\n * Base contract interface required for compatibility with ChainAdapter instances like EVM and Bitcoin.\n *\n * See {@link EVM} and {@link Bitcoin} for example implementations.\n */\nexport abstract class BaseChainSignatureContract {\n  /**\n   * Gets the current signature deposit required by the contract.\n   * This deposit amount helps manage network congestion.\n   *\n   * @returns Promise resolving to the required deposit amount as a BigNumber\n   */\n  abstract getCurrentSignatureDeposit(): Promise<BN>\n\n  /**\n   * Gets the derived public key for a given path and predecessor.\n   *\n   * @param args - Arguments for key derivation\n   * @param args.path - The path to use derive the key\n   * @param args.predecessor - The id/address of the account requesting signature\n   * @param args.IsEd25519 - Flag indicating if the key is Ed25519\n   * @returns Promise resolving to the derived SEC1 uncompressed public key\n   */\n  // abstract getDerivedPublicKey(args: ArgsEd25519): Promise<Ed25519PubKey>\n  abstract getDerivedPublicKey(\n    args: DerivedPublicKeyArgs | ArgsEd25519\n  ): Promise<UncompressedPubKeySEC1 | Ed25519PubKey>\n}\n\n/**\n * Full contract interface that extends BaseChainSignatureContract to provide all Sig Network Smart Contract capabilities.\n */\nexport abstract class ChainSignatureContract extends BaseChainSignatureContract {\n  /**\n   * Signs a payload using Sig Network MPC.\n   *\n   * @param args - Arguments for the signing operation\n   * @param args.payload - The data to sign as an array of 32 bytes\n   * @param args.path - The string path to use derive the key\n   * @param args.key_version - Version of the key to use\n   * @returns Promise resolving to the RSV signature\n   */\n  abstract sign(args: SignArgs & Record<string, unknown>): Promise<RSVSignature>\n\n  /**\n   * Gets the public key associated with this contract instance.\n   *\n   * @returns Promise resolving to the SEC1 uncompressed public key\n   */\n  abstract getPublicKey(): Promise<UncompressedPubKeySEC1>\n}\n","import * as signAndSend from './signAndSend'\nimport * as transaction from './transaction'\nexport * from './ChainSignatureContract'\n\nconst utils = {\n  transaction,\n  signAndSend,\n}\n\nexport { utils }\n","export * as keypair from './keypair'\n","import { type KeyPair } from '@near-js/crypto'\n\nimport * as chainAdapters from '@chain-adapters'\nimport { BTCRpcAdapters } from '@chain-adapters/Bitcoin/BTCRpcAdapter'\nimport { getNearAccount } from '@contracts/near/account'\nimport { ChainSignatureContract } from '@contracts/near/ChainSignatureContract'\nimport {\n  type Response,\n  type BitcoinRequest,\n  type CosmosRequest,\n  type EVMRequest,\n} from '@contracts/near/types'\nimport { createPublicClient, http } from 'viem';\n\nexport const EVMTransaction = async (\n  req: EVMRequest,\n  keyPair: KeyPair\n): Promise<Response> => {\n  try {\n    const account = await getNearAccount({\n      networkId: req.nearAuthentication.networkId,\n      accountId: req.nearAuthentication.accountId,\n      keypair: keyPair,\n    })\n\n    const contract = new ChainSignatureContract({\n      networkId: req.nearAuthentication.networkId,\n      contractId: req.chainConfig.contract,\n      accountId: account.accountId,\n      keypair: keyPair,\n    })\n\n    const evm = new chainAdapters.evm.EVM({\n      publicClient: createPublicClient({\n        transport: http(req.chainConfig.providerUrl),\n      }),\n      contract,\n    })\n\n    const { transaction, hashesToSign } =\n      await evm.prepareTransactionForSigning(req.transaction)\n\n    const signature = await contract.sign({\n      payload: hashesToSign[0],\n      path: req.derivationPath,\n      key_version: 0,\n    })\n\n    const txSerialized = evm.finalizeTransactionSigning({\n      transaction,\n      rsvSignatures: [signature],\n    })\n\n    const txHash = await evm.broadcastTx(txSerialized)\n\n    return {\n      transactionHash: txHash.hash,\n      success: true,\n    }\n  } catch (e: unknown) {\n    console.error(e)\n    return {\n      success: false,\n      errorMessage: e instanceof Error ? e.message : String(e),\n    }\n  }\n}\n\nexport const BTCTransaction = async (\n  req: BitcoinRequest,\n  keyPair: KeyPair\n): Promise<Response> => {\n  try {\n    const account = await getNearAccount({\n      networkId: req.nearAuthentication.networkId,\n      accountId: req.nearAuthentication.accountId,\n      keypair: keyPair,\n    })\n\n    const contract = new ChainSignatureContract({\n      networkId: req.nearAuthentication.networkId,\n      contractId: req.chainConfig.contract,\n      accountId: account.accountId,\n      keypair: keyPair,\n    })\n\n    const btc = new chainAdapters.btc.Bitcoin({\n      btcRpcAdapter: new BTCRpcAdapters.Mempool(req.chainConfig.providerUrl),\n      contract,\n      network: req.chainConfig.network,\n    })\n\n    const { transaction, hashesToSign } =\n      await btc.prepareTransactionForSigning(req.transaction)\n\n    const signatures = await Promise.all(\n      hashesToSign.map(\n        async (payload) =>\n          await contract.sign({\n            payload,\n            path: req.derivationPath,\n            key_version: 0,\n          })\n      )\n    )\n\n    const txSerialized = btc.finalizeTransactionSigning({\n      transaction,\n      rsvSignatures: signatures,\n    })\n\n    const txHash = await btc.broadcastTx(txSerialized)\n\n    return {\n      transactionHash: txHash.hash,\n      success: true,\n    }\n  } catch (e: unknown) {\n    return {\n      success: false,\n      errorMessage: e instanceof Error ? e.message : String(e),\n    }\n  }\n}\n\nexport const CosmosTransaction = async (\n  req: CosmosRequest,\n  keyPair: KeyPair\n): Promise<Response> => {\n  try {\n    const account = await getNearAccount({\n      networkId: req.nearAuthentication.networkId,\n      accountId: req.nearAuthentication.accountId,\n      keypair: keyPair,\n    })\n\n    const contract = new ChainSignatureContract({\n      networkId: req.nearAuthentication.networkId,\n      contractId: req.chainConfig.contract,\n      accountId: account.accountId,\n      keypair: keyPair,\n    })\n\n    const cosmos = new chainAdapters.cosmos.Cosmos({\n      contract,\n      chainId: req.chainConfig.chainId,\n    })\n\n    const { transaction, hashesToSign } =\n      await cosmos.prepareTransactionForSigning(req.transaction)\n\n    const signatures = await Promise.all(\n      hashesToSign.map(\n        async (payload) =>\n          await contract.sign({\n            payload,\n            path: req.derivationPath,\n            key_version: 0,\n          })\n      )\n    )\n\n    const txSerialized = cosmos.finalizeTransactionSigning({\n      transaction,\n      rsvSignatures: signatures,\n    })\n\n    const txHash = await cosmos.broadcastTx(txSerialized)\n\n    return {\n      transactionHash: txHash,\n      success: true,\n    }\n  } catch (e: unknown) {\n    console.error(e)\n    return {\n      success: false,\n      errorMessage: e instanceof Error ? e.message : String(e),\n    }\n  }\n}\n","import { Account, Connection } from '@near-js/accounts'\nimport { KeyPair } from '@near-js/crypto'\nimport { InMemoryKeyStore } from '@near-js/keystores'\n\nimport { DONT_CARE_ACCOUNT_ID } from '@contracts/near/constants'\n\ntype SetConnectionArgs =\n  | {\n      networkId: string\n      accountId: string\n      keypair: KeyPair\n    }\n  | {\n      networkId: string\n      accountId?: never\n      keypair?: never\n    }\n\nexport const getNearAccount = async ({\n  networkId,\n  accountId = DONT_CARE_ACCOUNT_ID,\n  keypair = KeyPair.fromRandom('ed25519'),\n}: SetConnectionArgs): Promise<Account> => {\n  const keyStore = new InMemoryKeyStore()\n  await keyStore.setKey(networkId, accountId, keypair)\n\n  const connection = Connection.fromConfig({\n    networkId,\n    provider: {\n      type: 'JsonRpcProvider',\n      args: {\n        url: {\n          testnet: 'https://rpc.testnet.near.org',\n          mainnet: 'https://rpc.mainnet.near.org',\n        }[networkId],\n      },\n    },\n    signer: { type: 'InMemorySigner', keyStore },\n  })\n\n  return new Account(connection, accountId)\n}\n","import BN from 'bn.js'\n\nexport const NEAR_MAX_GAS = new BN('300000000000000')\nexport const DONT_CARE_ACCOUNT_ID = 'dontcare'\n","import { Contract } from '@near-js/accounts'\nimport { KeyPair } from '@near-js/crypto'\nimport { actionCreators } from '@near-js/transactions'\nimport { najToUncompressedPubKeySEC1 } from '@utils/cryptography'\nimport { getRootPublicKey } from '@utils/publicKey'\nimport BN from 'bn.js'\n\nimport { KDF_CHAIN_ID } from '@constants'\nimport { ChainSignatureContract as AbstractChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { SignArgs } from '@contracts/ChainSignatureContract'\nimport { getNearAccount } from '@contracts/near/account'\nimport { DONT_CARE_ACCOUNT_ID, NEAR_MAX_GAS } from '@contracts/near/constants'\nimport {\n  responseToMpcSignature,\n  type SendTransactionOptions,\n  sendTransactionUntil,\n} from '@contracts/near/transaction'\nimport {\n  type NearNetworkIds,\n  type ChainSignatureContractIds,\n} from '@contracts/near/types'\nimport type { RSVSignature, UncompressedPubKeySEC1, NajPublicKey } from '@types'\nimport { cryptography } from '@utils'\n\ntype NearContract = Contract & {\n  public_key: () => Promise<NajPublicKey>\n  experimental_signature_deposit: () => Promise<number>\n  derived_public_key: (args: {\n    path: string\n    predecessor: string\n    domain_id?: number\n  }) => Promise<NajPublicKey | `Ed25519:${string}`>\n}\n\ninterface ChainSignatureContractArgs {\n  networkId: NearNetworkIds\n  contractId: ChainSignatureContractIds\n  accountId?: string\n  keypair?: KeyPair\n  rootPublicKey?: NajPublicKey\n  sendTransactionOptions?: SendTransactionOptions\n}\n\n/**\n * Implementation of the ChainSignatureContract for NEAR chains.\n *\n * This class provides an interface to interact with the ChainSignatures contract\n * deployed on NEAR. It supports both view methods (which don't require authentication)\n * and change methods (which require a valid NEAR account and keypair).\n *\n * @extends AbstractChainSignatureContract\n */\nexport class ChainSignatureContract extends AbstractChainSignatureContract {\n  private readonly networkId: NearNetworkIds\n  private readonly contractId: ChainSignatureContractIds\n  private readonly accountId: string\n  private readonly keypair: KeyPair\n  private readonly rootPublicKey?: NajPublicKey\n  private readonly sendTransactionOptions?: SendTransactionOptions\n  /**\n   * Creates a new instance of the ChainSignatureContract for NEAR chains.\n   *\n   * @param args - Configuration options for the contract\n   * @param args.networkId - The NEAR network ID (e.g. 'testnet', 'mainnet')\n   * @param args.contractId - The contract ID of the deployed ChainSignatures contract\n   * @param args.accountId - Optional NEAR account ID for signing transactions. Required for change methods.\n   * @param args.keypair - Optional NEAR KeyPair for signing transactions. Required for change methods.\n   * @param args.rootPublicKey - Optional root public key for the contract. If not provided, it will be derived from the contract ID.\n   * @param args.sendTransactionOptions - Optional configuration for transaction sending behavior.\n   */\n  constructor({\n    networkId,\n    contractId,\n    accountId = DONT_CARE_ACCOUNT_ID,\n    keypair = KeyPair.fromRandom('ed25519'),\n    rootPublicKey,\n    sendTransactionOptions,\n  }: ChainSignatureContractArgs) {\n    super()\n\n    this.networkId = networkId\n    this.contractId = contractId\n    this.accountId = accountId\n    this.keypair = keypair\n    this.sendTransactionOptions = sendTransactionOptions\n\n    this.rootPublicKey =\n      rootPublicKey || getRootPublicKey(this.contractId)\n  }\n\n  private async getContract(): Promise<NearContract> {\n    const account = await getNearAccount({\n      networkId: this.networkId,\n      accountId: this.accountId,\n      keypair: this.keypair,\n    })\n\n    return new Contract(account, this.contractId, {\n      viewMethods: [\n        'public_key',\n        'experimental_signature_deposit',\n        'derived_public_key',\n      ],\n      // Change methods use the sendTransactionUntil because the internal retry of the Contract class\n      // throws on NodeJs.\n      changeMethods: [],\n      useLocalViewExecution: false,\n    }) as unknown as NearContract\n  }\n\n  async getCurrentSignatureDeposit(): Promise<BN> {\n    const contract = await this.getContract()\n    return new BN(\n      (await contract.experimental_signature_deposit()).toLocaleString(\n        'fullwide',\n        {\n          useGrouping: false,\n        }\n      )\n    )\n  }\n\n  async getDerivedPublicKey(args: {\n    path: string\n    predecessor: string\n    IsEd25519?: boolean\n  }): Promise<UncompressedPubKeySEC1 | `Ed25519:${string}`> {\n    if (args.IsEd25519) {\n      const contract = await this.getContract()\n      return (await contract.derived_public_key({\n        path: args.path,\n        predecessor: args.predecessor,\n        domain_id: 1,\n      })) as `Ed25519:${string}`\n    }\n\n    if (this.rootPublicKey) {\n      const pubKey = cryptography.deriveChildPublicKey(\n        await this.getPublicKey(),\n        args.predecessor.toLowerCase(),\n        args.path,\n        KDF_CHAIN_ID\n      )\n      return pubKey\n    } else {\n      // Support for legacy contract\n      const contract = await this.getContract()\n      const najPubKey = await contract.derived_public_key(args)\n      return najToUncompressedPubKeySEC1(najPubKey as NajPublicKey)\n    }\n  }\n\n  async getPublicKey(): Promise<UncompressedPubKeySEC1> {\n    if (this.rootPublicKey) {\n      return najToUncompressedPubKeySEC1(this.rootPublicKey)\n    } else {\n      // Support for legacy contract\n      const contract = await this.getContract()\n      const najPubKey = await contract.public_key()\n      return najToUncompressedPubKeySEC1(najPubKey)\n    }\n  }\n\n  async sign(\n    args: SignArgs,\n    options?: {\n      nonce?: number\n    }\n  ): Promise<RSVSignature> {\n    this.requireAccount()\n\n    const deposit = await this.getCurrentSignatureDeposit()\n\n    const result = await sendTransactionUntil({\n      accountId: this.accountId,\n      keypair: this.keypair,\n      networkId: this.networkId,\n      receiverId: this.contractId,\n      actions: [\n        actionCreators.functionCall(\n          'sign',\n          { request: args },\n          BigInt(NEAR_MAX_GAS.toString()),\n          BigInt(deposit.toString())\n        ),\n      ],\n      nonce: options?.nonce,\n      options: this.sendTransactionOptions,\n    })\n\n    const signature = responseToMpcSignature({ response: result })\n\n    if (!signature) {\n      throw new Error('Transaction failed')\n    }\n\n    return signature\n  }\n\n  private requireAccount(): void {\n    if (this.accountId === DONT_CARE_ACCOUNT_ID) {\n      throw new Error(\n        'A valid account ID and keypair are required for change methods. Please instantiate a new contract with valid credentials.'\n      )\n    }\n  }\n}\n","import { CONTRACT_ADDRESSES, ROOT_PUBLIC_KEYS } from '@constants'\nimport type { NajPublicKey } from '@types'\n\nexport const getRootPublicKey = (\n  contractAddress: string\n): NajPublicKey | undefined => {\n  const environment = Object.entries(CONTRACT_ADDRESSES).find(\n    ([_, address]) => address.toLowerCase() === contractAddress.toLowerCase()\n  )?.[0] as keyof typeof ROOT_PUBLIC_KEYS | undefined\n\n  if (environment) {\n    return ROOT_PUBLIC_KEYS[environment]\n  }\n\n  return undefined\n}\n","import { InMemoryKeyStore } from '@near-js/keystores'\nimport type { Action as TransactionAction } from '@near-js/transactions'\nimport type { TxExecutionStatus } from '@near-js/types'\nimport type {\n  Action as WalletAction,\n  FinalExecutionOutcome,\n  NetworkId,\n} from '@near-wallet-selector/core'\nimport BN from 'bn.js'\nimport {\n  transactions,\n  utils as nearUtils,\n  connect,\n  type KeyPair,\n} from 'near-api-js'\nimport { getTransactionLastResult } from 'near-api-js/lib/providers'\nimport { withRetry } from 'viem'\n\nimport { ChainSignatureContract } from '@contracts/near/ChainSignatureContract'\nimport { NEAR_MAX_GAS } from '@contracts/near/constants'\nimport { type ChainSignatureContractIds } from '@contracts/near/types'\nimport {\n  type RSVSignature,\n  type KeyDerivationPath,\n  type MPCSignature,\n  type HashToSign,\n} from '@types'\nimport { cryptography } from '@utils'\n\nexport const mpcPayloadsToChainSigTransaction = async ({\n  networkId,\n  contractId,\n  hashesToSign,\n  path,\n}: {\n  networkId: NetworkId\n  contractId: ChainSignatureContractIds\n  hashesToSign: HashToSign[]\n  path: KeyDerivationPath\n}): Promise<{\n  receiverId: string\n  actions: WalletAction[]\n}> => {\n  const contract = new ChainSignatureContract({\n    networkId,\n    contractId,\n  })\n\n  const currentContractFee = await contract.getCurrentSignatureDeposit()\n\n  return {\n    receiverId: contractId,\n    actions: hashesToSign.map((payload) => ({\n      type: 'FunctionCall',\n      params: {\n        methodName: 'sign',\n        args: {\n          request: {\n            payload: Array.from(payload),\n            path,\n            key_version: 0,\n          },\n        },\n        gas: NEAR_MAX_GAS.div(new BN(hashesToSign.length)).toString(),\n        deposit: currentContractFee?.toString() || '1',\n      },\n    })),\n  }\n}\n\nexport const responseToMpcSignature = ({\n  response,\n}: {\n  response: FinalExecutionOutcome\n}): RSVSignature | undefined => {\n  const signature = getTransactionLastResult(response) as MPCSignature\n\n  if (signature) {\n    return cryptography.toRSV(signature)\n  } else {\n    return undefined\n  }\n}\n\nexport interface SendTransactionOptions {\n  until: TxExecutionStatus\n  retryCount: number\n  delay: number\n  nodeUrl: string\n}\n\nexport const sendTransactionUntil = async ({\n  accountId,\n  keypair,\n  networkId,\n  receiverId,\n  actions,\n  nonce,\n  options = {\n    until: 'EXECUTED_OPTIMISTIC',\n    retryCount: 3,\n    delay: 5000, // Near RPC timeout\n    nodeUrl:\n      networkId === 'testnet'\n        ? 'https://test.rpc.fastnear.com'\n        : 'https://free.rpc.fastnear.com',\n  },\n}: {\n  accountId: string\n  keypair: KeyPair\n  networkId: NetworkId\n  receiverId: string\n  actions: TransactionAction[]\n  nonce?: number\n  options?: SendTransactionOptions\n}): Promise<FinalExecutionOutcome> => {\n  const keyStore = new InMemoryKeyStore()\n  await keyStore.setKey(networkId, accountId, keypair)\n\n  const near = await connect({\n    networkId,\n    keyStore,\n    nodeUrl: options.nodeUrl,\n  })\n\n  const { signer } = near.connection\n  const publicKey = await signer.getPublicKey(\n    accountId,\n    near.connection.networkId\n  )\n\n  const accessKey = (await near.connection.provider.query(\n    `access_key/${accountId}/${publicKey.toString()}`,\n    ''\n  )) as unknown as {\n    block_hash: string\n    block_height: number\n    nonce: number\n    permission: string\n  }\n\n  const recentBlockHash = nearUtils.serialize.base_decode(accessKey.block_hash)\n\n  const tx = transactions.createTransaction(\n    accountId,\n    publicKey,\n    receiverId,\n    nonce ?? ++accessKey.nonce,\n    actions,\n    recentBlockHash\n  )\n\n  const serializedTx = nearUtils.serialize.serialize(\n    transactions.SCHEMA.Transaction,\n    tx\n  )\n\n  const nearTransactionSignature = await signer.signMessage(\n    serializedTx,\n    accountId,\n    near.connection.networkId\n  )\n\n  const signedTransaction = new transactions.SignedTransaction({\n    transaction: tx,\n    signature: new transactions.Signature({\n      keyType: tx.publicKey.keyType,\n      data: nearTransactionSignature.signature,\n    }),\n  })\n\n  const { transaction } = await near.connection.provider.sendTransactionUntil(\n    signedTransaction,\n    'INCLUDED_FINAL'\n  )\n\n  const txHash = transaction.hash as string | undefined\n\n  if (!txHash) {\n    throw new Error('No transaction hash found')\n  }\n\n  return await withRetry(\n    async () => {\n      const txOutcome = await near.connection.provider.txStatus(\n        txHash,\n        accountId,\n        options.until\n      )\n\n      if (txOutcome) {\n        return txOutcome\n      }\n\n      throw new Error('Transaction not found')\n    },\n    {\n      retryCount: options.retryCount,\n      delay: options.delay,\n    }\n  )\n}\n"]}