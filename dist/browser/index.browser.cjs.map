{"version":3,"sources":["../../src/constants.ts","../../src/utils/index.ts","../../src/utils/cryptography.ts","../../src/chain-adapters/index.ts","../../src/chain-adapters/ChainAdapter.ts","../../src/chain-adapters/EVM/index.ts","../../src/chain-adapters/EVM/utils.ts","../../src/chain-adapters/EVM/EVM.ts","../../src/chain-adapters/Bitcoin/index.ts","../../src/chain-adapters/Bitcoin/Bitcoin.ts","../../src/chain-adapters/Bitcoin/utils.ts","../../src/chain-adapters/Bitcoin/BTCRpcAdapter/Mempool/Mempool.ts","../../src/chain-adapters/Bitcoin/BTCRpcAdapter/BTCRpcAdapter.ts","../../src/chain-adapters/Bitcoin/BTCRpcAdapter/index.ts","../../src/chain-adapters/Cosmos/index.ts","../../src/chain-adapters/Cosmos/utils.ts","../../src/chain-adapters/Cosmos/Cosmos.ts","../../src/chain-adapters/Solana/index.ts","../../src/chain-adapters/Solana/Solana.ts","../../src/contracts/index.ts","../../src/contracts/ChainSignatureContract.ts","../../src/contracts/near/index.ts","../../src/contracts/near/signAndSend/index.ts","../../src/contracts/near/signAndSend/keypair.ts","../../src/contracts/near/account.ts","../../src/contracts/near/constants.ts","../../src/contracts/near/ChainSignatureContract.ts","../../src/utils/publicKey.ts","../../src/contracts/near/transaction.ts"],"names":["constants_exports","__export","CHAINS","CONTRACT_ADDRESSES","ENVS","KDF_CHAIN_IDS","ROOT_PUBLIC_KEYS","utils_exports","cryptography_exports","compressPubKey","deriveChildPublicKey","najToUncompressedPubKeySEC1","toRSV","signature","uncompressedPubKeySEC1","slicedPubKey","x","y","najPublicKey","decodedKey","base58","rootUncompressedPubKeySEC1","predecessorId","path","chainId","ec","EC","derivationPath","scalarHex","keccak256","sha3_256","oldPublicKeyPoint","scalarTimesG","newPublicKeyPoint","newX","newY","chain_adapters_exports","ChainAdapter","Bitcoin_exports","Cosmos_exports","EVM_exports","Solana_exports","EVM","fetchEVMFeeProperties","client","transaction","gas","feeData","maxFeePerGas","maxPriorityFeePerGas","publicClient","contract","fees","nonce","from","rest","r","s","yParity","concatHex","numberToHex","predecessor","uncompressedPubKey","publicKeyNoPrefix","hash","getAddress","address","serializeTransaction","serialized","parseTransaction","transactionRequest","serializedTx","txHash","toBytes","message","hashMessage","typedDataRequest","hashTypedData","userOp","entryPointAddress","chainIdArgs","entryPoint","encoded","encodeAbiParameters","hexToBigInt","concat","pad","isAddress","userOpHash","rsvSignatures","rsvSignature","txSerialized","error","BTCRpcAdapter","BTCRpcAdapters","Bitcoin","parseBTCNetwork","network","z","_Bitcoin","btcRpcAdapter","satoshis","btc","transactionId","data","tx","T","vout","scriptPubKey","rawSignature","inputs","outputs","psbt","input","prevOut","out","derivedKey","publicKeyBuffer","payment","transactionJSON","psbtHex","hashesToSign","mockKeyPair","index","publicKey","keyPair","mpcSignature","Mempool","providerUrl","confirmationTarget","targets","utxos","feeRate","ret","coinselect","transactionHex","response","txid","Cosmos","fetchChainInfo","chainInfo","chains","chain","prefix","expectedChainId","denom","rpcUrl","restUrl","gasPrice","asset","assets","decimals","unit","endpoints","Registry","fromHex","amount","b","pubKeySha256","sha256","ripemd160Hash","ripemd160","bech32","TxRaw","toBase64","fromBase64","publicKeyBytes","gasLimit","fee","calculateFee","GasPrice","accountOnChain","StargateClient","accountNumber","sequence","txBodyEncodeObject","txBodyBytes","pubkey","encodePubkey","encodeSecp256k1Pubkey","authInfoBytes","makeAuthInfoBytes","SignMode","signDoc","makeSignDoc","signBytes","makeSignBytes","payload","sig","txBytes","broadcastResponse","Solana","toBigInt","value","args","PublicKey","balance","base58Key","buffer","Transaction","request","SystemProgram","blockhash","messageBytes","senderAddress","signatureBuffer","contracts_exports","ChainSignatureContract","near_exports","BaseChainSignatureContract","utils","signAndSend_exports","keypair_exports","BTCTransaction","CosmosTransaction","EVMTransaction","NEAR_MAX_GAS","BN","DONT_CARE_ACCOUNT_ID","getNearAccount","networkId","accountId","keypair","KeyPair","keyStore","InMemoryKeyStore","connection","Connection","Account","getRootPublicKey","contractAddress","environment","_","transaction_exports","mpcPayloadsToChainSigTransaction","responseToMpcSignature","sendTransactionUntil","contractId","currentContractFee","getTransactionLastResult","receiverId","actions","options","near","connect","signer","accessKey","recentBlockHash","nearUtils","transactions","nearTransactionSignature","signedTransaction","withRetry","txOutcome","rootPublicKey","sendTransactionOptions","account","Contract","najPubKey","deposit","result","actionCreators","req","evm","createPublicClient","http","signatures","cosmos"],"mappings":"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","file":"index.browser.cjs","sourcesContent":["import { type NajPublicKey } from '@types'\n\nexport const ENVS = {\n  TESTNET_DEV: 'TESTNET_DEV',\n  TESTNET: 'TESTNET',\n  MAINNET: 'MAINNET',\n} as const\n\nexport const CHAINS = {\n  ETHEREUM: 'ETHEREUM',\n  NEAR: 'NEAR',\n} as const\n\n/**\n * Root public keys for the Sig Network Smart Contracts across different environments.\n *\n * These keys should never change.\n */\nexport const ROOT_PUBLIC_KEYS: Record<keyof typeof ENVS, NajPublicKey> = {\n  [ENVS.TESTNET_DEV]:\n    'secp256k1:54hU5wcCmVUPFWLDALXMh1fFToZsVXrx9BbTbHzSfQq1Kd1rJZi52iPa4QQxo6s5TgjWqgpY8HamYuUDzG6fAaUq',\n  [ENVS.TESTNET]:\n    'secp256k1:3Ww8iFjqTHufye5aRGUvrQqETegR4gVUcW8FX5xzscaN9ENhpkffojsxJwi6N1RbbHMTxYa9UyKeqK3fsMuwxjR5',\n  [ENVS.MAINNET]:\n    'secp256k1:4tY4qMzusmgX5wYdG35663Y3Qar3CTbpApotwk9ZKLoF79XA4DjG8XoByaKdNHKQX9Lz5hd7iJqsWdTKyA7dKa6Z',\n}\n\n/**\n * Chain IDs used in the key derivation function (KDF) for deriving child public keys to\n * distinguish between different chains.\n *\n * @see {@link deriveChildPublicKey} in cryptography.ts for usage details\n */\nexport const KDF_CHAIN_IDS = {\n  [CHAINS.ETHEREUM]: '0x1',\n  [CHAINS.NEAR]: '0x18d',\n} as const\n\n/**\n * Contract addresses for different chains and environments.\n *\n * - Testnet Dev: Used for internal development, very unstable\n * - Testnet: Used for external development, stable\n * - Mainnet: Production contract address\n *\n * @see ChainSignatureContract documentation for implementation details\n */\nexport const CONTRACT_ADDRESSES: Record<\n  keyof typeof CHAINS,\n  Record<keyof typeof ENVS, string>\n> = {\n  [CHAINS.NEAR]: {\n    [ENVS.TESTNET_DEV]: 'dev.sig-net.testnet',\n    [ENVS.TESTNET]: 'v1.sig-net.testnet',\n    [ENVS.MAINNET]: 'v1.sig-net.near',\n  },\n  [CHAINS.ETHEREUM]: {\n    [ENVS.TESTNET_DEV]: '0x69C6b28Fdc74618817fa380De29a653060e14009',\n    [ENVS.TESTNET]: '0x83458E8Bf8206131Fe5c05127007FA164c0948A2',\n    [ENVS.MAINNET]: '0xf8bdC0612361a1E49a8E01423d4C0cFc5dF4791A',\n  },\n}\n","export * as cryptography from './cryptography'\n","import { base58 } from '@scure/base'\nimport { ec as EC } from 'elliptic'\nimport { sha3_256 } from 'js-sha3'\nimport { keccak256 } from 'viem'\n\nimport { KDF_CHAIN_IDS } from '@constants'\nimport {\n  type NajPublicKey,\n  type MPCSignature,\n  type RSVSignature,\n  type UncompressedPubKeySEC1,\n} from '@types'\n\nexport const toRSV = (signature: MPCSignature): RSVSignature => {\n  // Handle NearNearMpcSignature\n  if (\n    'big_r' in signature &&\n    typeof signature.big_r === 'object' &&\n    'affine_point' in signature.big_r &&\n    's' in signature &&\n    typeof signature.s === 'object' &&\n    'scalar' in signature.s\n  ) {\n    return {\n      r: signature.big_r.affine_point.substring(2),\n      s: signature.s.scalar,\n      v: signature.recovery_id + 27,\n    }\n  }\n  // Handle ChainSigNearMpcSignature\n  else if (\n    'big_r' in signature &&\n    typeof signature.big_r === 'string' &&\n    's' in signature &&\n    typeof signature.s === 'string'\n  ) {\n    return {\n      r: signature.big_r.substring(2),\n      s: signature.s,\n      v: signature.recovery_id + 27,\n    }\n  }\n  // Handle ChainSigEvmMpcSignature\n  else if (\n    'bigR' in signature &&\n    'x' in signature.bigR &&\n    's' in signature &&\n    typeof signature.s === 'bigint'\n  ) {\n    return {\n      r: signature.bigR.x.toString(16).padStart(64, '0'),\n      s: signature.s.toString(16).padStart(64, '0'),\n      v: signature.recoveryId + 27,\n    }\n  }\n\n  throw new Error('Invalid signature format')\n}\n\n/**\n * Compresses an uncompressed public key to its compressed format following SEC1 standards.\n * In SEC1, a compressed public key consists of a prefix (02 or 03) followed by the x-coordinate.\n * The prefix indicates whether the y-coordinate is even (02) or odd (03).\n *\n * @param uncompressedPubKeySEC1 - The uncompressed public key in hex format, with or without '04' prefix\n * @returns The compressed public key in hex format\n * @throws Error if the uncompressed public key length is invalid\n */\nexport const compressPubKey = (\n  uncompressedPubKeySEC1: UncompressedPubKeySEC1\n): string => {\n  const slicedPubKey = uncompressedPubKeySEC1.slice(2)\n\n  if (slicedPubKey.length !== 128) {\n    throw new Error('Invalid uncompressed public key length')\n  }\n\n  const x = slicedPubKey.slice(0, 64)\n  const y = slicedPubKey.slice(64)\n\n  const isEven = parseInt(y.slice(-1), 16) % 2 === 0\n  const prefix = isEven ? '02' : '03'\n\n  return prefix + x\n}\n\n/**\n * Converts a NAJ public key to an uncompressed SEC1 public key.\n *\n * @param najPublicKey - The NAJ public key to convert (e.g. secp256k1:3Ww8iFjqTHufye5aRGUvrQqETegR4gVUcW8FX5xzscaN9ENhpkffojsxJwi6N1RbbHMTxYa9UyKeqK3fsMuwxjR5)\n * @returns The uncompressed SEC1 public key (e.g. 04 || x || y)\n */\nexport const najToUncompressedPubKeySEC1 = (\n  najPublicKey: NajPublicKey\n): UncompressedPubKeySEC1 => {\n  const decodedKey = base58.decode(najPublicKey.split(':')[1])\n  return `04${Buffer.from(decodedKey).toString('hex')}`\n}\n\n/**\n * Derives a child public key from a parent public key using the sig.network v1.0.0 epsilon derivation scheme.\n * The parent public keys are defined in @constants.ts\n *\n * @param najPublicKey - The parent public key in uncompressed SEC1 format (e.g. 04 || x || y)\n * @param predecessorId - The predecessor ID is the address of the account calling the signer contract (e.g EOA or Contract Address)\n * @param path - Optional derivation path suffix (defaults to empty string)\n * @returns The derived child public key in uncompressed SEC1 format (04 || x || y)\n */\nexport function deriveChildPublicKey(\n  rootUncompressedPubKeySEC1: UncompressedPubKeySEC1,\n  predecessorId: string,\n  path: string = '',\n  chainId: string\n): UncompressedPubKeySEC1 {\n  const ec = new EC('secp256k1')\n\n  const EPSILON_DERIVATION_PREFIX = 'sig.network v1.0.0 epsilon derivation'\n  const derivationPath = `${EPSILON_DERIVATION_PREFIX},${chainId},${predecessorId},${path}`\n\n  let scalarHex = ''\n\n  if (chainId === KDF_CHAIN_IDS.ETHEREUM) {\n    scalarHex = keccak256(Buffer.from(derivationPath)).slice(2)\n  } else if (chainId === KDF_CHAIN_IDS.NEAR) {\n    scalarHex = sha3_256(derivationPath)\n  } else {\n    throw new Error('Invalid chain ID')\n  }\n\n  const x = rootUncompressedPubKeySEC1.substring(2, 66)\n  const y = rootUncompressedPubKeySEC1.substring(66)\n\n  const oldPublicKeyPoint = ec.curve.point(x, y)\n  const scalarTimesG = ec.g.mul(scalarHex)\n  const newPublicKeyPoint = oldPublicKeyPoint.add(scalarTimesG)\n\n  const newX = newPublicKeyPoint.getX().toString('hex').padStart(64, '0')\n  const newY = newPublicKeyPoint.getY().toString('hex').padStart(64, '0')\n\n  return `04${newX}${newY}`\n}\n","export { ChainAdapter } from './ChainAdapter'\n\nexport * as evm from './EVM'\nexport * as btc from './Bitcoin'\nexport * as cosmos from './Cosmos'\nexport * as solana from './Solana'\n","import { type Transaction } from '@solana/web3.js'\n\nimport type { HashToSign, RSVSignature, Signature } from '@types'\n\nexport abstract class ChainAdapter<TransactionRequest, UnsignedTransaction> {\n  /**\n   * Gets the native token balance and decimals for a given address\n   *\n   * @param address - The address to check\n   * @returns Promise resolving to an object containing:\n   *          - balance: The balance as a bigint, in the chain's base units\n   *          - decimals: The number of decimals used to format the balance\n   */\n  abstract getBalance(address: string): Promise<{\n    balance: bigint\n    decimals: number\n  }>\n\n  /**\n   * Uses Sig Network Key Derivation Function to derive the address and public key. from a signer ID and string path.\n   *\n   * @param predecessor - The id/address of the account requesting signature\n   * @param path - The string path used to derive the key\n   * @returns Promise resolving to the derived address and public key\n   */\n  abstract deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{\n    address: string\n    publicKey: string\n  }>\n\n  /**\n   * Serializes an unsigned transaction to a string format.\n   * This is useful for storing or transmitting the transaction.\n   *\n   * @param transaction - The unsigned transaction to serialize\n   * @returns The serialized transaction string\n   */\n  abstract serializeTransaction(transaction: UnsignedTransaction): string\n\n  /**\n   * Deserializes a transaction string back into an unsigned transaction object.\n   * This reverses the serialization done by serializeTransaction().\n   *\n   * @param serialized - The serialized transaction string\n   * @returns The deserialized unsigned transaction\n   */\n  abstract deserializeTransaction(serialized: string): UnsignedTransaction\n\n  /**\n   * Prepares a transaction for Sig Network MPC signing by creating the necessary payloads.\n   * This method handles chain-specific transaction preparation including:\n   * - Fee calculation\n   * - Nonce/sequence management\n   * - UTXO selection (for UTXO-based chains)\n   * - Transaction encoding\n   *\n   * @param transactionRequest - The transaction request containing parameters like recipient, amount, etc.\n   * @returns Promise resolving to an object containing:\n   *          - transaction: The unsigned transaction\n   *          - hashesToSign: Array of payloads to be signed by MPC. The order of these payloads must match\n   *                         the order of signatures provided to finalizeTransactionSigning()\n   */\n  abstract prepareTransactionForSigning(\n    transactionRequest: TransactionRequest\n  ): Promise<{\n    transaction: UnsignedTransaction\n    hashesToSign: HashToSign[]\n  }>\n\n  /**\n   * Adds Sig Network MPC-generated signatures to an unsigned transaction.\n   *\n   * @param params - Parameters for adding signatures\n   * @param params.transaction - The unsigned transaction to add signatures to\n   * @param params.rsvSignatures - Array of RSV signatures generated through MPC. Must be in the same order\n   *                              as the payloads returned by prepareTransactionForSigning()\n   * @returns The serialized signed transaction ready for broadcast\n   */\n  abstract finalizeTransactionSigning(params: {\n    transaction: UnsignedTransaction | Transaction\n    rsvSignatures: RSVSignature[] | Signature\n  }): string\n\n  /**\n   * Broadcasts a signed transaction to the network.\n   *\n   * @param txSerialized - The serialized signed transaction\n   * @returns Promise resolving to an object containing the transaction hash/ID\n   */\n  abstract broadcastTx(txSerialized: string): Promise<{ hash: string }>\n}\n","// EVM\nexport { EVM } from './EVM'\n\nexport { fetchEVMFeeProperties } from './utils'\n\nexport type {\n  EVMTransactionRequest,\n  EVMUnsignedTransaction,\n  EVMMessage,\n  EVMTypedData,\n} from './types'\n","import { type PublicClient, type TransactionRequest } from 'viem'\n\nexport interface EVMFeeProperties {\n  gas: bigint\n  maxFeePerGas: bigint\n  maxPriorityFeePerGas: bigint\n}\n\nexport async function fetchEVMFeeProperties(\n  client: PublicClient,\n  transaction: TransactionRequest\n): Promise<EVMFeeProperties> {\n  const [gas, feeData] = await Promise.all([\n    client.estimateGas(transaction),\n    client.estimateFeesPerGas(),\n  ])\n\n  const maxFeePerGas = feeData.maxFeePerGas ?? BigInt(10_000_000_000) // 10 gwei\n  const maxPriorityFeePerGas =\n    feeData.maxPriorityFeePerGas ?? BigInt(10_000_000_000) // 10 gwei\n\n  return {\n    gas,\n    maxFeePerGas,\n    maxPriorityFeePerGas,\n  }\n}\n","import {\n  parseTransaction,\n  type PublicClient,\n  hashMessage,\n  hashTypedData,\n  keccak256,\n  toBytes,\n  type Hex,\n  serializeTransaction,\n  type Signature,\n  numberToHex,\n  getAddress,\n  type Address,\n  type Hash,\n  concatHex,\n  encodeAbiParameters,\n  hexToBigInt,\n  concat,\n  pad,\n  isAddress,\n} from 'viem'\n\nimport { ChainAdapter } from '@chain-adapters/ChainAdapter'\nimport type {\n  EVMTransactionRequest,\n  EVMUnsignedTransaction,\n  EVMMessage,\n  EVMTypedData,\n  UserOperationV6,\n  UserOperationV7,\n} from '@chain-adapters/EVM/types'\nimport { fetchEVMFeeProperties } from '@chain-adapters/EVM/utils'\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, RSVSignature } from '@types'\n\n/**\n * Implementation of the ChainAdapter interface for EVM-compatible networks.\n * Handles interactions with Ethereum Virtual Machine based blockchains like Ethereum, BSC, Polygon, etc.\n */\nexport class EVM extends ChainAdapter<\n  EVMTransactionRequest,\n  EVMUnsignedTransaction\n> {\n  private readonly client: PublicClient\n  private readonly contract: BaseChainSignatureContract\n\n  /**\n   * Creates a new EVM chain instance\n   * @param params - Configuration parameters\n   * @param params.publicClient - A Viem PublicClient instance for reading from the blockchain\n   * @param params.contract - Instance of the chain signature contract for MPC operations\n   */\n  constructor({\n    publicClient,\n    contract,\n  }: {\n    publicClient: PublicClient\n    contract: BaseChainSignatureContract\n  }) {\n    super()\n\n    this.contract = contract\n    this.client = publicClient\n  }\n\n  private async attachGasAndNonce(\n    transaction: EVMTransactionRequest\n  ): Promise<EVMUnsignedTransaction> {\n    const fees = await fetchEVMFeeProperties(this.client, transaction)\n    const nonce = await this.client.getTransactionCount({\n      address: transaction.from,\n    })\n\n    const { from, ...rest } = transaction\n\n    return {\n      ...fees,\n      nonce,\n      chainId: Number(await this.client.getChainId()),\n      type: 'eip1559',\n      ...rest,\n    }\n  }\n\n  private transformRSVSignature(signature: RSVSignature): Signature {\n    return {\n      r: `0x${signature.r}`,\n      s: `0x${signature.s}`,\n      yParity: signature.v - 27,\n    }\n  }\n\n  private assembleSignature(signature: RSVSignature): Hex {\n    const { r, s, yParity } = this.transformRSVSignature(signature)\n\n    if (yParity === undefined) {\n      throw new Error('Missing yParity')\n    }\n\n    return concatHex([r, s, numberToHex(yParity + 27, { size: 1 })])\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{\n    address: string\n    publicKey: string\n  }> {\n    const uncompressedPubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n    })\n\n    if (!uncompressedPubKey) {\n      throw new Error('Failed to get derived public key')\n    }\n\n    const publicKeyNoPrefix = uncompressedPubKey.startsWith('04')\n      ? uncompressedPubKey.slice(2)\n      : uncompressedPubKey\n\n    const hash = keccak256(Buffer.from(publicKeyNoPrefix, 'hex'))\n    const address = getAddress(`0x${hash.slice(-40)}`)\n\n    return {\n      address,\n      publicKey: uncompressedPubKey,\n    }\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    const balance = await this.client.getBalance({\n      address: address as Address,\n    })\n    return {\n      balance,\n      decimals: 18,\n    }\n  }\n\n  serializeTransaction(transaction: EVMUnsignedTransaction): `0x${string}` {\n    return serializeTransaction(transaction)\n  }\n\n  deserializeTransaction(serialized: `0x${string}`): EVMUnsignedTransaction {\n    return parseTransaction(serialized) as EVMUnsignedTransaction\n  }\n\n  async prepareTransactionForSigning(\n    transactionRequest: EVMTransactionRequest\n  ): Promise<{\n    transaction: EVMUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const transaction = await this.attachGasAndNonce(transactionRequest)\n\n    const serializedTx = serializeTransaction(transaction)\n    const txHash = toBytes(keccak256(serializedTx))\n\n    return {\n      transaction,\n      hashesToSign: [Array.from(txHash)],\n    }\n  }\n\n  async prepareMessageForSigning(message: EVMMessage): Promise<{\n    hashToSign: HashToSign\n  }> {\n    return {\n      hashToSign: Array.from(toBytes(hashMessage(message))),\n    }\n  }\n\n  async prepareTypedDataForSigning(typedDataRequest: EVMTypedData): Promise<{\n    hashToSign: HashToSign\n  }> {\n    return {\n      hashToSign: Array.from(toBytes(hashTypedData(typedDataRequest))),\n    }\n  }\n\n  /**\n   * This implementation is a common step for Biconomy and Alchemy.\n   * Key differences between implementations:\n   * - Signature format: Biconomy omits 0x00 prefix when concatenating, Alchemy includes it\n   * - Version support: Biconomy only supports v6, Alchemy supports both v6 and v7\n   * - Validation: Biconomy uses modules for signature validation, Alchemy uses built-in validation\n   */\n  async prepareUserOpForSigning(\n    userOp: UserOperationV7 | UserOperationV6,\n    entryPointAddress?: Address,\n    chainIdArgs?: number\n  ): Promise<{\n    userOp: UserOperationV7 | UserOperationV6\n    hashToSign: HashToSign\n  }> {\n    const chainId = chainIdArgs ?? (await this.client.getChainId())\n    const entryPoint =\n      entryPointAddress || '0x0000000071727De22E5E9d8BAf0edAc6f37da032'\n\n    const encoded = encodeAbiParameters(\n      [{ type: 'bytes32' }, { type: 'address' }, { type: 'uint256' }],\n      [\n        keccak256(\n          encodeAbiParameters(\n            [\n              { type: 'address' },\n              { type: 'uint256' },\n              { type: 'bytes32' },\n              { type: 'bytes32' },\n              { type: 'bytes32' },\n              { type: 'uint256' },\n              { type: 'bytes32' },\n              { type: 'bytes32' },\n            ],\n            [\n              userOp.sender,\n              hexToBigInt(userOp.nonce),\n              keccak256(\n                'factory' in userOp &&\n                  'factoryData' in userOp &&\n                  userOp.factory &&\n                  userOp.factoryData\n                  ? concat([userOp.factory, userOp.factoryData])\n                  : 'initCode' in userOp\n                    ? userOp.initCode\n                    : '0x'\n              ),\n              keccak256(userOp.callData),\n              concat([\n                pad(userOp.verificationGasLimit, { size: 16 }),\n                pad(userOp.callGasLimit, { size: 16 }),\n              ]),\n              hexToBigInt(userOp.preVerificationGas),\n              concat([\n                pad(userOp.maxPriorityFeePerGas, { size: 16 }),\n                pad(userOp.maxFeePerGas, { size: 16 }),\n              ]),\n              keccak256(\n                'paymaster' in userOp &&\n                  userOp.paymaster &&\n                  isAddress(userOp.paymaster)\n                  ? concat([\n                    userOp.paymaster,\n                    pad(userOp.paymasterVerificationGasLimit, { size: 16 }),\n                    pad(userOp.paymasterPostOpGasLimit, { size: 16 }),\n                    userOp.paymasterData,\n                  ])\n                  : 'paymasterAndData' in userOp\n                    ? userOp.paymasterAndData\n                    : '0x'\n              ),\n            ]\n          )\n        ),\n        entryPoint,\n        BigInt(chainId),\n      ]\n    )\n\n    const userOpHash = keccak256(encoded)\n\n    return {\n      userOp,\n      hashToSign: Array.from(toBytes(hashMessage({ raw: userOpHash }))),\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction,\n    rsvSignatures,\n  }: {\n    transaction: EVMUnsignedTransaction\n    rsvSignatures: RSVSignature[]\n  }): `0x02${string}` {\n    const signature = this.transformRSVSignature(rsvSignatures[0])\n\n    return serializeTransaction(transaction, signature)\n  }\n\n  finalizeMessageSigning({\n    rsvSignature,\n  }: {\n    rsvSignature: RSVSignature\n  }): Hex {\n    return this.assembleSignature(rsvSignature)\n  }\n\n  finalizeTypedDataSigning({\n    rsvSignature,\n  }: {\n    rsvSignature: RSVSignature\n  }): Hex {\n    return this.assembleSignature(rsvSignature)\n  }\n\n  finalizeUserOpSigning({\n    userOp,\n    rsvSignature,\n  }: {\n    userOp: UserOperationV7 | UserOperationV6\n    rsvSignature: RSVSignature\n  }): UserOperationV7 | UserOperationV6 {\n    const { r, s, yParity } = this.transformRSVSignature(rsvSignature)\n    if (yParity === undefined) {\n      throw new Error('Missing yParity')\n    }\n\n    return {\n      ...userOp,\n      signature: concatHex([\n        '0x00', // Alchemy specific implementation. Biconomy doesn't include the 0x00 prefix.\n        r,\n        s,\n        numberToHex(Number(yParity + 27), { size: 1 }),\n      ]),\n    }\n  }\n\n  async broadcastTx(txSerialized: string): Promise<{ hash: Hash }> {\n    try {\n      const hash = await this.client.sendRawTransaction({\n        serializedTransaction: txSerialized as `0x${string}`,\n      })\n      return { hash: hash }\n    } catch (error) {\n      console.error('Transaction broadcast failed:', error)\n      throw new Error('Failed to broadcast transaction.')\n    }\n  }\n}\n","// Bitcoin\nexport { Bitcoin } from './Bitcoin'\n\nexport { BTCRpcAdapters, BTCRpcAdapter } from './BTCRpcAdapter'\n\nexport type {\n  BTCTransactionRequest,\n  BTCUnsignedTransaction,\n  BTCTransaction,\n  BTCOutput,\n  BTCInput,\n  BTCNetworkIds,\n} from './types'\n","import * as bitcoin from 'bitcoinjs-lib'\n\nimport { type BTCRpcAdapter } from '@chain-adapters/Bitcoin/BTCRpcAdapter'\nimport type {\n  BTCInput,\n  BTCNetworkIds,\n  BTCOutput,\n  BTCTransactionRequest,\n  BTCUnsignedTransaction,\n} from '@chain-adapters/Bitcoin/types'\nimport { parseBTCNetwork } from '@chain-adapters/Bitcoin/utils'\nimport { ChainAdapter } from '@chain-adapters/ChainAdapter'\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, RSVSignature, UncompressedPubKeySEC1 } from '@types'\nimport { cryptography } from '@utils'\n\n/**\n * Implementation of the ChainAdapter interface for Bitcoin network.\n * Handles interactions with both Bitcoin mainnet and testnet, supporting P2WPKH transactions.\n */\nexport class Bitcoin extends ChainAdapter<\n  BTCTransactionRequest,\n  BTCUnsignedTransaction\n> {\n  private static readonly SATOSHIS_PER_BTC = 100_000_000\n\n  private readonly network: BTCNetworkIds\n  private readonly btcRpcAdapter: BTCRpcAdapter\n  private readonly contract: BaseChainSignatureContract\n\n  /**\n   * Creates a new Bitcoin chain instance\n   * @param params - Configuration parameters\n   * @param params.network - Network identifier (mainnet/testnet)\n   * @param params.contract - Instance of the chain signature contract for MPC operations\n   * @param params.btcRpcAdapter - Bitcoin RPC adapter for network interactions\n   */\n  constructor({\n    network,\n    contract,\n    btcRpcAdapter,\n  }: {\n    network: BTCNetworkIds\n    contract: BaseChainSignatureContract\n    btcRpcAdapter: BTCRpcAdapter\n  }) {\n    super()\n\n    this.network = network\n    this.btcRpcAdapter = btcRpcAdapter\n    this.contract = contract\n  }\n\n  /**\n   * Converts satoshis to BTC\n   * @param satoshis - Amount in satoshis\n   * @returns Amount in BTC\n   */\n  static toBTC(satoshis: number): number {\n    return satoshis / Bitcoin.SATOSHIS_PER_BTC\n  }\n\n  /**\n   * Converts BTC to satoshis\n   * @param btc - Amount in BTC\n   * @returns Amount in satoshis (rounded)\n   */\n  static toSatoshi(btc: number): number {\n    return Math.round(btc * Bitcoin.SATOSHIS_PER_BTC)\n  }\n\n  private async fetchTransaction(\n    transactionId: string\n  ): Promise<bitcoin.Transaction> {\n    const data = await this.btcRpcAdapter.getTransaction(transactionId)\n    const tx = new bitcoin.Transaction()\n\n    data.vout.forEach((vout) => {\n      const scriptPubKey = Buffer.from(vout.scriptpubkey, 'hex')\n      tx.addOutput(scriptPubKey, Number(vout.value))\n    })\n\n    return tx\n  }\n\n  private static transformRSVSignature(signature: RSVSignature): Buffer {\n    const r = signature.r.padStart(64, '0')\n    const s = signature.s.padStart(64, '0')\n\n    const rawSignature = Buffer.from(r + s, 'hex')\n\n    if (rawSignature.length !== 64) {\n      throw new Error('Invalid signature length.')\n    }\n\n    return rawSignature\n  }\n\n  /**\n   * Creates a Partially Signed Bitcoin Transaction (PSBT)\n   * @param params - Parameters for creating the PSBT\n   * @param params.transactionRequest - Transaction request containing inputs and outputs\n   * @returns Created PSBT instance\n   */\n  async createPSBT({\n    transactionRequest,\n  }: {\n    transactionRequest: BTCTransactionRequest\n  }): Promise<bitcoin.Psbt> {\n    const { inputs, outputs } =\n      transactionRequest.inputs && transactionRequest.outputs\n        ? transactionRequest\n        : await this.btcRpcAdapter.selectUTXOs(transactionRequest.from, [\n            {\n              address: transactionRequest.to,\n              value: parseFloat(transactionRequest.value),\n            },\n          ])\n\n    const psbt = new bitcoin.Psbt({ network: parseBTCNetwork(this.network) })\n\n    await Promise.all(\n      inputs.map(async (input: BTCInput) => {\n        if (!input.scriptPubKey) {\n          const transaction = await this.fetchTransaction(input.txid)\n          const prevOut = transaction.outs[input.vout]\n          input.scriptPubKey = prevOut.script\n        }\n\n        // Prepare the input as P2WPKH\n        psbt.addInput({\n          hash: input.txid,\n          index: input.vout,\n          witnessUtxo: {\n            script: input.scriptPubKey,\n            value: input.value,\n          },\n        })\n      })\n    )\n\n    outputs.forEach((out: BTCOutput) => {\n      if ('address' in out) {\n        psbt.addOutput({\n          address: out.address,\n          value: out.value,\n        })\n      } else if ('script' in out) {\n        psbt.addOutput({\n          script: out.script,\n          value: out.value,\n        })\n      } else if (transactionRequest.from !== undefined) {\n        // Include change address from coinselect\n        psbt.addOutput({\n          value: Number(out.value),\n          address: transactionRequest.from,\n        })\n      }\n    })\n\n    return psbt\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    const balance = BigInt(await this.btcRpcAdapter.getBalance(address))\n    return {\n      balance,\n      decimals: 8,\n    }\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{ address: string; publicKey: string }> {\n    const uncompressedPubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n    })\n\n    if (!uncompressedPubKey) {\n      throw new Error('Failed to get derived public key')\n    }\n\n    const derivedKey = cryptography.compressPubKey(\n      uncompressedPubKey as UncompressedPubKeySEC1\n    )\n    const publicKeyBuffer = Buffer.from(derivedKey, 'hex')\n    const network = parseBTCNetwork(this.network)\n\n    const payment = bitcoin.payments.p2wpkh({\n      pubkey: publicKeyBuffer,\n      network,\n    })\n\n    const { address } = payment\n\n    if (!address) {\n      throw new Error('Failed to generate Bitcoin address')\n    }\n\n    return { address, publicKey: derivedKey }\n  }\n\n  serializeTransaction(transaction: BTCUnsignedTransaction): string {\n    return JSON.stringify({\n      psbt: transaction.psbt.toHex(),\n      publicKey: transaction.publicKey,\n    })\n  }\n\n  deserializeTransaction(serialized: string): BTCUnsignedTransaction {\n    const transactionJSON = JSON.parse(serialized)\n    return {\n      psbt: bitcoin.Psbt.fromHex(transactionJSON.psbt as string),\n      publicKey: transactionJSON.publicKey,\n    }\n  }\n\n  async prepareTransactionForSigning(\n    transactionRequest: BTCTransactionRequest\n  ): Promise<{\n    transaction: BTCUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const publicKeyBuffer = Buffer.from(transactionRequest.publicKey, 'hex')\n    const psbt = await this.createPSBT({\n      transactionRequest,\n    })\n\n    // We can't double sign a PSBT, therefore we serialize the payload before to return it\n    const psbtHex = psbt.toHex()\n\n    const hashesToSign: HashToSign[] = []\n\n    const mockKeyPair = (index: number): bitcoin.Signer => ({\n      publicKey: publicKeyBuffer,\n      sign: (hash: Buffer): Buffer => {\n        hashesToSign[index] = Array.from(hash)\n        // Return dummy signature to satisfy the interface\n        return Buffer.alloc(64)\n      },\n    })\n\n    for (let index = 0; index < psbt.inputCount; index++) {\n      psbt.signInput(index, mockKeyPair(index))\n    }\n\n    return {\n      transaction: {\n        psbt: bitcoin.Psbt.fromHex(psbtHex),\n        publicKey: transactionRequest.publicKey,\n      },\n      hashesToSign,\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction: { psbt, publicKey },\n    rsvSignatures,\n  }: {\n    transaction: BTCUnsignedTransaction\n    rsvSignatures: RSVSignature[]\n  }): string {\n    const publicKeyBuffer = Buffer.from(publicKey, 'hex')\n\n    const keyPair = (index: number): bitcoin.Signer => ({\n      publicKey: publicKeyBuffer,\n      sign: () => {\n        const mpcSignature = rsvSignatures[index]\n        return Bitcoin.transformRSVSignature(mpcSignature)\n      },\n    })\n\n    for (let index = 0; index < psbt.inputCount; index++) {\n      psbt.signInput(index, keyPair(index))\n    }\n\n    psbt.finalizeAllInputs()\n    return psbt.extractTransaction().toHex()\n  }\n\n  async broadcastTx(txSerialized: string): Promise<{ hash: string }> {\n    const txId = await this.btcRpcAdapter.broadcastTransaction(txSerialized)\n    return { hash: txId }\n  }\n}\n","import * as bitcoin from 'bitcoinjs-lib'\n\nexport function parseBTCNetwork(network: string): bitcoin.networks.Network {\n  switch (network.toLowerCase()) {\n    case 'mainnet':\n      return bitcoin.networks.bitcoin\n    case 'testnet':\n      return bitcoin.networks.testnet\n    case 'regtest':\n      return bitcoin.networks.regtest\n    default:\n      throw new Error(`Unknown Bitcoin network: ${network}`)\n  }\n}\n","// There is no types for coinselect\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-expect-error\n\nimport coinselect from 'coinselect'\n\nimport { BTCRpcAdapter } from '@chain-adapters/Bitcoin/BTCRpcAdapter/BTCRpcAdapter'\nimport {\n  type BTCFeeRecommendation,\n  type UTXO,\n} from '@chain-adapters/Bitcoin/BTCRpcAdapter/Mempool/types'\nimport type {\n  BTCTransaction,\n  BTCInput,\n  BTCOutput,\n} from '@chain-adapters/Bitcoin/types'\n\nexport class Mempool extends BTCRpcAdapter {\n  private readonly providerUrl: string\n\n  constructor(providerUrl: string) {\n    super()\n    this.providerUrl = providerUrl\n  }\n\n  private async fetchFeeRate(confirmationTarget = 6): Promise<number> {\n    const response = await fetch(`${this.providerUrl}/v1/fees/recommended`)\n    const data = (await response.json()) as BTCFeeRecommendation\n\n    if (confirmationTarget <= 1) {\n      return data.fastestFee\n    } else if (confirmationTarget <= 3) {\n      return data.halfHourFee\n    } else if (confirmationTarget <= 6) {\n      return data.hourFee\n    } else {\n      return data.economyFee\n    }\n  }\n\n  private async fetchUTXOs(address: string): Promise<UTXO[]> {\n    try {\n      const response = await fetch(\n        `${this.providerUrl}/address/${address}/utxo`\n      )\n      return (await response.json()) as UTXO[]\n    } catch (error) {\n      console.error('Failed to fetch UTXOs:', error)\n      return []\n    }\n  }\n\n  async selectUTXOs(\n    from: string,\n    targets: BTCOutput[],\n    confirmationTarget = 6\n  ): Promise<{ inputs: BTCInput[]; outputs: BTCOutput[] }> {\n    const utxos = await this.fetchUTXOs(from)\n    const feeRate = await this.fetchFeeRate(confirmationTarget)\n\n    // Add a small amount to the fee rate to ensure the transaction is confirmed\n    const ret = coinselect(utxos, targets, Math.ceil(feeRate + 1))\n\n    if (!ret.inputs || !ret.outputs) {\n      throw new Error(\n        'Invalid transaction: coinselect failed to find a suitable set of inputs and outputs. This could be due to insufficient funds, or no inputs being available that meet the criteria.'\n      )\n    }\n\n    return {\n      inputs: ret.inputs,\n      outputs: ret.outputs,\n    }\n  }\n\n  async broadcastTransaction(transactionHex: string): Promise<string> {\n    const response = await fetch(`${this.providerUrl}/tx`, {\n      method: 'POST',\n      body: transactionHex,\n    })\n\n    if (response.ok) {\n      return await response.text()\n    }\n\n    throw new Error(`Failed to broadcast transaction: ${await response.text()}`)\n  }\n\n  async getBalance(address: string): Promise<number> {\n    const response = await fetch(`${this.providerUrl}/address/${address}`)\n    const data = (await response.json()) as {\n      chain_stats: { funded_txo_sum: number; spent_txo_sum: number }\n    }\n    return data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum\n  }\n\n  async getTransaction(txid: string): Promise<BTCTransaction> {\n    const response = await fetch(`${this.providerUrl}/tx/${txid}`)\n    return (await response.json()) as BTCTransaction\n  }\n}\n","import type {\n  BTCTransaction,\n  BTCInput,\n  BTCOutput,\n} from '@chain-adapters/Bitcoin/types'\n\nexport abstract class BTCRpcAdapter {\n  abstract selectUTXOs(\n    from: string,\n    targets: BTCOutput[]\n  ): Promise<{ inputs: BTCInput[]; outputs: BTCOutput[] }>\n  abstract broadcastTransaction(transactionHex: string): Promise<string>\n  abstract getBalance(address: string): Promise<number>\n  abstract getTransaction(txid: string): Promise<BTCTransaction>\n}\n","import { Mempool } from './Mempool'\nexport { BTCRpcAdapter } from './BTCRpcAdapter'\n\nexport const BTCRpcAdapters = {\n  Mempool,\n}\n","// Cosmos\nexport { Cosmos } from './Cosmos'\n\nexport type {\n  CosmosNetworkIds,\n  CosmosTransactionRequest,\n  CosmosUnsignedTransaction,\n} from './types'\n","import { chains, assets } from 'chain-registry'\n\nimport { type ChainInfo } from '@chain-adapters/Cosmos/types'\n\nexport const fetchChainInfo = async (chainId: string): Promise<ChainInfo> => {\n  const chainInfo = chains.find((chain) => chain.chain_id === chainId)\n  if (!chainInfo) {\n    throw new Error(`Chain info not found for chainId: ${chainId}`)\n  }\n\n  const { bech32_prefix: prefix, chain_id: expectedChainId } = chainInfo\n  const denom = chainInfo.staking?.staking_tokens?.[0]?.denom\n  const rpcUrl = chainInfo.apis?.rpc?.[0]?.address\n  const restUrl = chainInfo.apis?.rest?.[0]?.address\n  const gasPrice = chainInfo.fees?.fee_tokens?.[0]?.average_gas_price\n\n  if (\n    !prefix ||\n    !denom ||\n    !rpcUrl ||\n    !restUrl ||\n    !expectedChainId ||\n    gasPrice === undefined\n  ) {\n    throw new Error(\n      `Missing required chain information for ${chainInfo.chain_name}`\n    )\n  }\n\n  const assetList = assets.find(\n    (asset) => asset.chain_name === chainInfo.chain_name\n  )\n  const asset = assetList?.assets.find((asset) => asset.base === denom)\n  const decimals = asset?.denom_units.find(\n    (unit) => unit.denom === asset.display\n  )?.exponent\n\n  if (decimals === undefined) {\n    throw new Error(\n      `Could not find decimals for ${denom} on chain ${chainInfo.chain_name}`\n    )\n  }\n\n  return { prefix, denom, rpcUrl, restUrl, expectedChainId, gasPrice, decimals }\n}\n","import { encodeSecp256k1Pubkey } from '@cosmjs/amino'\nimport { ripemd160, sha256 } from '@cosmjs/crypto'\nimport { toBase64, fromBase64, fromHex } from '@cosmjs/encoding'\nimport {\n  Registry,\n  makeSignBytes,\n  encodePubkey,\n  makeAuthInfoBytes,\n  makeSignDoc,\n  type TxBodyEncodeObject,\n} from '@cosmjs/proto-signing'\nimport { GasPrice, StargateClient, calculateFee } from '@cosmjs/stargate'\nimport { bech32 } from 'bech32'\nimport { SignMode } from 'cosmjs-types/cosmos/tx/signing/v1beta1/signing'\nimport { TxRaw } from 'cosmjs-types/cosmos/tx/v1beta1/tx'\n\nimport { ChainAdapter } from '@chain-adapters/ChainAdapter'\nimport type {\n  CosmosNetworkIds,\n  CosmosTransactionRequest,\n  CosmosUnsignedTransaction,\n  ChainInfo,\n  BalanceResponse,\n} from '@chain-adapters/Cosmos/types'\nimport { fetchChainInfo } from '@chain-adapters/Cosmos/utils'\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, RSVSignature, UncompressedPubKeySEC1 } from '@types'\nimport { cryptography } from '@utils'\n\n/**\n * Implementation of the ChainAdapter interface for Cosmos-based networks.\n * Handles interactions with Cosmos SDK chains like Cosmos Hub, Osmosis, etc.\n */\nexport class Cosmos extends ChainAdapter<\n  CosmosTransactionRequest,\n  CosmosUnsignedTransaction\n> {\n  private readonly registry: Registry\n  private readonly chainId: CosmosNetworkIds\n  private readonly contract: BaseChainSignatureContract\n  private readonly endpoints?: {\n    rpcUrl?: string\n    restUrl?: string\n  }\n\n  /**\n   * Creates a new Cosmos chain instance\n   * @param params - Configuration parameters\n   * @param params.chainId - Chain id for the Cosmos network\n   * @param params.contract - Instance of the chain signature contract for MPC operations\n   * @param params.endpoints - Optional RPC and REST endpoints\n   * @param params.endpoints.rpcUrl - Optional RPC endpoint URL\n   * @param params.endpoints.restUrl - Optional REST endpoint URL\n   */\n  constructor({\n    chainId,\n    contract,\n    endpoints,\n  }: {\n    contract: BaseChainSignatureContract\n    chainId: CosmosNetworkIds\n    endpoints?: {\n      rpcUrl?: string\n      restUrl?: string\n    }\n  }) {\n    super()\n\n    this.contract = contract\n    this.registry = new Registry()\n    this.chainId = chainId\n    this.endpoints = endpoints\n  }\n\n  private transformRSVSignature(rsvSignature: RSVSignature): Uint8Array {\n    return new Uint8Array([\n      ...fromHex(rsvSignature.r),\n      ...fromHex(rsvSignature.s),\n    ])\n  }\n\n  private async getChainInfo(): Promise<ChainInfo> {\n    return {\n      ...(await fetchChainInfo(this.chainId)),\n      ...this.endpoints,\n    }\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    try {\n      const { restUrl, denom, decimals } = await this.getChainInfo()\n\n      const response = await fetch(\n        `${restUrl}/cosmos/bank/v1beta1/balances/${address}`\n      )\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`)\n      }\n\n      const data = (await response.json()) as BalanceResponse\n      const balance = data.balances.find((b) => b.denom === denom)\n      const amount = balance?.amount ?? '0'\n\n      return {\n        balance: BigInt(amount),\n        decimals,\n      }\n    } catch (error) {\n      console.error('Failed to fetch Cosmos balance:', error)\n      throw new Error('Failed to fetch Cosmos balance')\n    }\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{\n    address: string\n    publicKey: string\n  }> {\n    const { prefix } = await this.getChainInfo()\n    const uncompressedPubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n    })\n\n    if (!uncompressedPubKey) {\n      throw new Error('Failed to get derived public key')\n    }\n\n    const derivedKey = cryptography.compressPubKey(\n      uncompressedPubKey as UncompressedPubKeySEC1\n    )\n    const pubKeySha256 = sha256(fromHex(derivedKey))\n    const ripemd160Hash = ripemd160(pubKeySha256)\n    const address = bech32.encode(prefix, bech32.toWords(ripemd160Hash))\n\n    return { address, publicKey: derivedKey }\n  }\n\n  serializeTransaction(transaction: CosmosUnsignedTransaction): string {\n    const serialized = TxRaw.encode(transaction).finish()\n    return toBase64(serialized)\n  }\n\n  deserializeTransaction(serialized: string): CosmosUnsignedTransaction {\n    return TxRaw.decode(fromBase64(serialized))\n  }\n\n  async prepareTransactionForSigning(\n    transactionRequest: CosmosTransactionRequest\n  ): Promise<{\n    transaction: CosmosUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const { denom, rpcUrl, gasPrice } = await this.getChainInfo()\n    const publicKeyBytes = fromHex(transactionRequest.publicKey)\n\n    const gasLimit = transactionRequest.gas || 200_000\n\n    const fee = calculateFee(\n      gasLimit,\n      GasPrice.fromString(`${gasPrice}${denom}`)\n    )\n\n    const client = await StargateClient.connect(rpcUrl)\n    const accountOnChain = await client.getAccount(transactionRequest.address)\n    if (!accountOnChain) {\n      throw new Error(\n        `Account ${transactionRequest.address} does not exist on chain`\n      )\n    }\n\n    const { accountNumber, sequence } = accountOnChain\n\n    const txBodyEncodeObject: TxBodyEncodeObject = {\n      typeUrl: '/cosmos.tx.v1beta1.TxBody',\n      value: {\n        messages: transactionRequest.messages,\n        memo: transactionRequest.memo || '',\n      },\n    }\n\n    const txBodyBytes = this.registry.encode(txBodyEncodeObject)\n\n    const pubkey = encodePubkey(encodeSecp256k1Pubkey(publicKeyBytes))\n\n    // TODO: Allow caller to provide: multiple signers, fee payer, fee granter\n    const authInfoBytes = makeAuthInfoBytes(\n      [\n        {\n          pubkey,\n          sequence,\n        },\n      ],\n      fee.amount,\n      Number(fee.gas),\n      undefined,\n      undefined,\n      SignMode.SIGN_MODE_DIRECT\n    )\n\n    const signDoc = makeSignDoc(\n      txBodyBytes,\n      authInfoBytes,\n      this.chainId,\n      accountNumber\n    )\n\n    const signBytes = makeSignBytes(signDoc)\n    const payload = Array.from(sha256(signBytes))\n\n    return {\n      transaction: TxRaw.fromPartial({\n        bodyBytes: txBodyBytes,\n        authInfoBytes,\n        signatures: [],\n      }),\n      hashesToSign: [payload],\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction,\n    rsvSignatures,\n  }: {\n    transaction: CosmosUnsignedTransaction\n    rsvSignatures: RSVSignature[]\n  }): string {\n    // Allow support for multi-sig but the package only supports single-sig\n    transaction.signatures = rsvSignatures.map((sig) =>\n      this.transformRSVSignature(sig)\n    )\n\n    const txBytes = TxRaw.encode(transaction).finish()\n    return Buffer.from(txBytes).toString('hex')\n  }\n\n  // @ts-expect-error - TODO: fix this\n  async broadcastTx(txSerialized: string): Promise<string> {\n    try {\n      const { rpcUrl } = await this.getChainInfo()\n      const client = await StargateClient.connect(rpcUrl)\n\n      const txBytes = fromHex(txSerialized)\n      const broadcastResponse = await client.broadcastTx(txBytes)\n\n      if (broadcastResponse.code !== 0) {\n        throw new Error(`Broadcast error: ${broadcastResponse.rawLog}`)\n      }\n\n      return broadcastResponse.transactionHash\n    } catch (error) {\n      console.error('Transaction broadcast failed:', error)\n      throw new Error('Failed to broadcast transaction.')\n    }\n  }\n}\n","export * from './Solana'\nexport * from './types'\n","import type { Connection as SolanaConnection } from '@solana/web3.js'\nimport { PublicKey, Transaction, SystemProgram } from '@solana/web3.js'\nimport type BN from 'bn.js'\n\nimport type { BaseChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { HashToSign, Signature } from '@types'\n\nimport { ChainAdapter } from '../ChainAdapter'\n\nimport type {\n  SolanaTransactionRequest,\n  SolanaUnsignedTransaction,\n} from './types'\n\nconst toBigInt = (value: bigint | BN): bigint => {\n  if (typeof value === 'bigint') return value\n  return BigInt(value.toString())\n}\n\nexport class Solana extends ChainAdapter<\n  SolanaTransactionRequest,\n  SolanaUnsignedTransaction\n> {\n  private readonly connection: SolanaConnection\n  private readonly contract: BaseChainSignatureContract\n\n  constructor(args: {\n    solanaConnection: SolanaConnection\n    contract: BaseChainSignatureContract\n  }) {\n    super()\n    this.connection = args.solanaConnection\n    this.contract = args.contract\n  }\n\n  async getBalance(\n    address: string\n  ): Promise<{ balance: bigint; decimals: number }> {\n    const pubkey = new PublicKey(address)\n    const balance = await this.connection.getBalance(pubkey)\n    return {\n      balance: BigInt(balance),\n      decimals: 9, // Solana uses 9 decimals (LAMPORTS_PER_SOL)\n    }\n  }\n\n  async deriveAddressAndPublicKey(\n    predecessor: string,\n    path: string\n  ): Promise<{ address: string; publicKey: string }> {\n    const pubKey = await this.contract.getDerivedPublicKey({\n      path,\n      predecessor,\n      IsEd25519: true,\n    })\n\n    const base58Key = pubKey.replace('ed25519:', '')\n    const publicKey = new PublicKey(base58Key)\n\n    return {\n      address: publicKey.toBase58(),\n      publicKey: publicKey.toString(),\n    }\n  }\n\n  serializeTransaction(transaction: SolanaUnsignedTransaction): string {\n    return Buffer.from(\n      transaction.transaction.serialize({\n        requireAllSignatures: false,\n      })\n    ).toString('base64')\n  }\n\n  deserializeTransaction(serialized: string): SolanaUnsignedTransaction {\n    const buffer = Buffer.from(serialized, 'base64')\n    const transaction = Transaction.from(buffer)\n\n    return {\n      transaction,\n      feePayer:\n        transaction.feePayer ||\n        new PublicKey('11111111111111111111111111111111'),\n      recentBlockhash: transaction.recentBlockhash || '',\n    }\n  }\n\n  async prepareTransactionForSigning(\n    request: SolanaTransactionRequest\n  ): Promise<{\n    transaction: SolanaUnsignedTransaction\n    hashesToSign: HashToSign[]\n  }> {\n    const transaction = new Transaction()\n\n    // Add transfer instruction if amount is specified\n    const amount = toBigInt(request.amount)\n    if (amount > 0n) {\n      transaction.add(\n        SystemProgram.transfer({\n          fromPubkey: new PublicKey(request.from),\n          toPubkey: new PublicKey(request.to),\n          lamports: Number(amount),\n        })\n      )\n    }\n\n    // Add any additional instructions\n    if (request.instructions) {\n      transaction.add(...request.instructions)\n    }\n\n    // Get recent blockhash\n    const { blockhash } = await this.connection.getLatestBlockhash()\n    transaction.recentBlockhash = blockhash\n\n    // Set fee payer\n    transaction.feePayer = request.feePayer || new PublicKey(request.from)\n\n    const messageBytes = transaction.compileMessage().serialize()\n\n    return {\n      transaction: {\n        transaction,\n        feePayer: transaction.feePayer,\n        recentBlockhash: blockhash,\n      },\n      hashesToSign: [Array.from(messageBytes)],\n    }\n  }\n\n  finalizeTransactionSigning({\n    transaction,\n    rsvSignatures,\n    senderAddress,\n  }: {\n    transaction: Transaction\n    rsvSignatures: Signature\n    senderAddress: string\n  }): string {\n    const signatureBuffer = Buffer.from(rsvSignatures.signature)\n    transaction.addSignature(new PublicKey(senderAddress), signatureBuffer)\n    return transaction.serialize().toString('base64')\n  }\n\n  async broadcastTx(txSerialized: string): Promise<{ hash: string }> {\n    const transaction = this.deserializeTransaction(txSerialized)\n\n    const signature = await this.connection.sendRawTransaction(\n      transaction.transaction.serialize()\n    )\n\n    return { hash: signature }\n  }\n}\n","export { ChainSignatureContract, type SignArgs } from './ChainSignatureContract'\n\nexport * as near from './near'","import type BN from 'bn.js'\n\nimport type {\n  RSVSignature,\n  UncompressedPubKeySEC1,\n  Ed25519PubKey,\n  DerivedPublicKeyArgs,\n} from '../types'\n\nexport interface ArgsEd25519 extends DerivedPublicKeyArgs {\n  IsEd25519: boolean\n}\n\nexport interface SignArgs {\n  /** The payload to sign as an array of 32 bytes */\n  payload: number[]\n  /** The derivation path for key generation */\n  path: string\n  /** Version of the key to use */\n  key_version: number\n}\n\n/**\n * Base contract interface required for compatibility with ChainAdapter instances like EVM and Bitcoin.\n *\n * See {@link EVM} and {@link Bitcoin} for example implementations.\n */\nexport abstract class BaseChainSignatureContract {\n  /**\n   * Gets the current signature deposit required by the contract.\n   * This deposit amount helps manage network congestion.\n   *\n   * @returns Promise resolving to the required deposit amount as a BigNumber\n   */\n  abstract getCurrentSignatureDeposit(): Promise<BN>\n\n  /**\n   * Gets the derived public key for a given path and predecessor.\n   *\n   * @param args - Arguments for key derivation\n   * @param args.path - The path to use derive the key\n   * @param args.predecessor - The id/address of the account requesting signature\n   * @param args.IsEd25519 - Flag indicating if the key is Ed25519\n   * @returns Promise resolving to the derived SEC1 uncompressed public key\n   */\n  // abstract getDerivedPublicKey(args: ArgsEd25519): Promise<Ed25519PubKey>\n  abstract getDerivedPublicKey(\n    args: DerivedPublicKeyArgs | ArgsEd25519\n  ): Promise<UncompressedPubKeySEC1 | Ed25519PubKey>\n}\n\n/**\n * Full contract interface that extends BaseChainSignatureContract to provide all Sig Network Smart Contract capabilities.\n */\nexport abstract class ChainSignatureContract extends BaseChainSignatureContract {\n  /**\n   * Signs a payload using Sig Network MPC.\n   *\n   * @param args - Arguments for the signing operation\n   * @param args.payload - The data to sign as an array of 32 bytes\n   * @param args.path - The string path to use derive the key\n   * @param args.key_version - Version of the key to use\n   * @returns Promise resolving to the RSV signature\n   */\n  abstract sign(args: SignArgs & Record<string, unknown>): Promise<RSVSignature>\n\n  /**\n   * Gets the public key associated with this contract instance.\n   *\n   * @returns Promise resolving to the SEC1 uncompressed public key\n   */\n  abstract getPublicKey(): Promise<UncompressedPubKeySEC1>\n}\n","import * as signAndSend from './signAndSend'\nimport * as transaction from './transaction'\nexport * from './ChainSignatureContract'\n\nconst utils = {\n  transaction,\n  signAndSend,\n}\n\nexport { utils }\n","export * as keypair from './keypair'\n","import { type KeyPair } from '@near-js/crypto'\n\nimport * as chainAdapters from '@chain-adapters'\nimport { BTCRpcAdapters } from '@chain-adapters/Bitcoin/BTCRpcAdapter'\nimport { getNearAccount } from '@contracts/near/account'\nimport { ChainSignatureContract } from '@contracts/near/ChainSignatureContract'\nimport {\n  type Response,\n  type BitcoinRequest,\n  type CosmosRequest,\n  type EVMRequest,\n} from '@contracts/near/types'\nimport { createPublicClient, http } from 'viem';\n\nexport const EVMTransaction = async (\n  req: EVMRequest,\n  keyPair: KeyPair\n): Promise<Response> => {\n  try {\n    const account = await getNearAccount({\n      networkId: req.nearAuthentication.networkId,\n      accountId: req.nearAuthentication.accountId,\n      keypair: keyPair,\n    })\n\n    const contract = new ChainSignatureContract({\n      networkId: req.nearAuthentication.networkId,\n      contractId: req.chainConfig.contract,\n      accountId: account.accountId,\n      keypair: keyPair,\n    })\n\n    const evm = new chainAdapters.evm.EVM({\n      publicClient: createPublicClient({\n        transport: http(req.chainConfig.providerUrl),\n      }),\n      contract,\n    })\n\n    const { transaction, hashesToSign } =\n      await evm.prepareTransactionForSigning(req.transaction)\n\n    const signature = await contract.sign({\n      payload: hashesToSign[0],\n      path: req.derivationPath,\n      key_version: 0,\n    })\n\n    const txSerialized = evm.finalizeTransactionSigning({\n      transaction,\n      rsvSignatures: [signature],\n    })\n\n    const txHash = await evm.broadcastTx(txSerialized)\n\n    return {\n      transactionHash: txHash.hash,\n      success: true,\n    }\n  } catch (e: unknown) {\n    console.error(e)\n    return {\n      success: false,\n      errorMessage: e instanceof Error ? e.message : String(e),\n    }\n  }\n}\n\nexport const BTCTransaction = async (\n  req: BitcoinRequest,\n  keyPair: KeyPair\n): Promise<Response> => {\n  try {\n    const account = await getNearAccount({\n      networkId: req.nearAuthentication.networkId,\n      accountId: req.nearAuthentication.accountId,\n      keypair: keyPair,\n    })\n\n    const contract = new ChainSignatureContract({\n      networkId: req.nearAuthentication.networkId,\n      contractId: req.chainConfig.contract,\n      accountId: account.accountId,\n      keypair: keyPair,\n    })\n\n    const btc = new chainAdapters.btc.Bitcoin({\n      btcRpcAdapter: new BTCRpcAdapters.Mempool(req.chainConfig.providerUrl),\n      contract,\n      network: req.chainConfig.network,\n    })\n\n    const { transaction, hashesToSign } =\n      await btc.prepareTransactionForSigning(req.transaction)\n\n    const signatures = await Promise.all(\n      hashesToSign.map(\n        async (payload) =>\n          await contract.sign({\n            payload,\n            path: req.derivationPath,\n            key_version: 0,\n          })\n      )\n    )\n\n    const txSerialized = btc.finalizeTransactionSigning({\n      transaction,\n      rsvSignatures: signatures,\n    })\n\n    const txHash = await btc.broadcastTx(txSerialized)\n\n    return {\n      transactionHash: txHash.hash,\n      success: true,\n    }\n  } catch (e: unknown) {\n    return {\n      success: false,\n      errorMessage: e instanceof Error ? e.message : String(e),\n    }\n  }\n}\n\nexport const CosmosTransaction = async (\n  req: CosmosRequest,\n  keyPair: KeyPair\n): Promise<Response> => {\n  try {\n    const account = await getNearAccount({\n      networkId: req.nearAuthentication.networkId,\n      accountId: req.nearAuthentication.accountId,\n      keypair: keyPair,\n    })\n\n    const contract = new ChainSignatureContract({\n      networkId: req.nearAuthentication.networkId,\n      contractId: req.chainConfig.contract,\n      accountId: account.accountId,\n      keypair: keyPair,\n    })\n\n    const cosmos = new chainAdapters.cosmos.Cosmos({\n      contract,\n      chainId: req.chainConfig.chainId,\n    })\n\n    const { transaction, hashesToSign } =\n      await cosmos.prepareTransactionForSigning(req.transaction)\n\n    const signatures = await Promise.all(\n      hashesToSign.map(\n        async (payload) =>\n          await contract.sign({\n            payload,\n            path: req.derivationPath,\n            key_version: 0,\n          })\n      )\n    )\n\n    const txSerialized = cosmos.finalizeTransactionSigning({\n      transaction,\n      rsvSignatures: signatures,\n    })\n\n    const txHash = await cosmos.broadcastTx(txSerialized)\n\n    return {\n      transactionHash: txHash,\n      success: true,\n    }\n  } catch (e: unknown) {\n    console.error(e)\n    return {\n      success: false,\n      errorMessage: e instanceof Error ? e.message : String(e),\n    }\n  }\n}\n","import { Account, Connection } from '@near-js/accounts'\nimport { KeyPair } from '@near-js/crypto'\nimport { InMemoryKeyStore } from '@near-js/keystores'\n\nimport { DONT_CARE_ACCOUNT_ID } from '@contracts/near/constants'\n\ntype SetConnectionArgs =\n  | {\n      networkId: string\n      accountId: string\n      keypair: KeyPair\n    }\n  | {\n      networkId: string\n      accountId?: never\n      keypair?: never\n    }\n\nexport const getNearAccount = async ({\n  networkId,\n  accountId = DONT_CARE_ACCOUNT_ID,\n  keypair = KeyPair.fromRandom('ed25519'),\n}: SetConnectionArgs): Promise<Account> => {\n  const keyStore = new InMemoryKeyStore()\n  await keyStore.setKey(networkId, accountId, keypair)\n\n  const connection = Connection.fromConfig({\n    networkId,\n    provider: {\n      type: 'JsonRpcProvider',\n      args: {\n        url: {\n          testnet: 'https://rpc.testnet.near.org',\n          mainnet: 'https://rpc.mainnet.near.org',\n        }[networkId],\n      },\n    },\n    signer: { type: 'InMemorySigner', keyStore },\n  })\n\n  return new Account(connection, accountId)\n}\n","import BN from 'bn.js'\n\nexport const NEAR_MAX_GAS = new BN('300000000000000')\nexport const DONT_CARE_ACCOUNT_ID = 'dontcare'\n","import { Contract } from '@near-js/accounts'\nimport { KeyPair } from '@near-js/crypto'\nimport { actionCreators } from '@near-js/transactions'\nimport { najToUncompressedPubKeySEC1 } from '@utils/cryptography'\nimport { getRootPublicKey } from '@utils/publicKey'\nimport BN from 'bn.js'\n\nimport { CHAINS, KDF_CHAIN_IDS } from '@constants'\nimport { ChainSignatureContract as AbstractChainSignatureContract } from '@contracts/ChainSignatureContract'\nimport type { SignArgs } from '@contracts/ChainSignatureContract'\nimport { getNearAccount } from '@contracts/near/account'\nimport { DONT_CARE_ACCOUNT_ID, NEAR_MAX_GAS } from '@contracts/near/constants'\nimport {\n  responseToMpcSignature,\n  type SendTransactionOptions,\n  sendTransactionUntil,\n} from '@contracts/near/transaction'\nimport {\n  type NearNetworkIds,\n  type ChainSignatureContractIds,\n} from '@contracts/near/types'\nimport type { RSVSignature, UncompressedPubKeySEC1, NajPublicKey } from '@types'\nimport { cryptography } from '@utils'\n\ntype NearContract = Contract & {\n  public_key: () => Promise<NajPublicKey>\n  experimental_signature_deposit: () => Promise<number>\n  derived_public_key: (args: {\n    path: string\n    predecessor: string\n    domain_id?: number\n  }) => Promise<NajPublicKey | `Ed25519:${string}`>\n}\n\ninterface ChainSignatureContractArgs {\n  networkId: NearNetworkIds\n  contractId: ChainSignatureContractIds\n  accountId?: string\n  keypair?: KeyPair\n  rootPublicKey?: NajPublicKey\n  sendTransactionOptions?: SendTransactionOptions\n}\n\n/**\n * Implementation of the ChainSignatureContract for NEAR chains.\n *\n * This class provides an interface to interact with the ChainSignatures contract\n * deployed on NEAR. It supports both view methods (which don't require authentication)\n * and change methods (which require a valid NEAR account and keypair).\n *\n * @extends AbstractChainSignatureContract\n */\nexport class ChainSignatureContract extends AbstractChainSignatureContract {\n  private readonly networkId: NearNetworkIds\n  private readonly contractId: ChainSignatureContractIds\n  private readonly accountId: string\n  private readonly keypair: KeyPair\n  private readonly rootPublicKey?: NajPublicKey\n  private readonly sendTransactionOptions?: SendTransactionOptions\n  /**\n   * Creates a new instance of the ChainSignatureContract for NEAR chains.\n   *\n   * @param args - Configuration options for the contract\n   * @param args.networkId - The NEAR network ID (e.g. 'testnet', 'mainnet')\n   * @param args.contractId - The contract ID of the deployed ChainSignatures contract\n   * @param args.accountId - Optional NEAR account ID for signing transactions. Required for change methods.\n   * @param args.keypair - Optional NEAR KeyPair for signing transactions. Required for change methods.\n   * @param args.rootPublicKey - Optional root public key for the contract. If not provided, it will be derived from the contract ID.\n   * @param args.sendTransactionOptions - Optional configuration for transaction sending behavior.\n   */\n  constructor({\n    networkId,\n    contractId,\n    accountId = DONT_CARE_ACCOUNT_ID,\n    keypair = KeyPair.fromRandom('ed25519'),\n    rootPublicKey,\n    sendTransactionOptions,\n  }: ChainSignatureContractArgs) {\n    super()\n\n    this.networkId = networkId\n    this.contractId = contractId\n    this.accountId = accountId\n    this.keypair = keypair\n    this.sendTransactionOptions = sendTransactionOptions\n\n    this.rootPublicKey =\n      rootPublicKey || getRootPublicKey(this.contractId, CHAINS.NEAR)\n  }\n\n  private async getContract(): Promise<NearContract> {\n    const account = await getNearAccount({\n      networkId: this.networkId,\n      accountId: this.accountId,\n      keypair: this.keypair,\n    })\n\n    return new Contract(account, this.contractId, {\n      viewMethods: [\n        'public_key',\n        'experimental_signature_deposit',\n        'derived_public_key',\n      ],\n      // Change methods use the sendTransactionUntil because the internal retry of the Contract class\n      // throws on NodeJs.\n      changeMethods: [],\n      useLocalViewExecution: false,\n    }) as unknown as NearContract\n  }\n\n  async getCurrentSignatureDeposit(): Promise<BN> {\n    const contract = await this.getContract()\n    return new BN(\n      (await contract.experimental_signature_deposit()).toLocaleString(\n        'fullwide',\n        {\n          useGrouping: false,\n        }\n      )\n    )\n  }\n\n  async getDerivedPublicKey(args: {\n    path: string\n    predecessor: string\n    IsEd25519?: boolean\n  }): Promise<UncompressedPubKeySEC1 | `Ed25519:${string}`> {\n    if (args.IsEd25519) {\n      const contract = await this.getContract()\n      return (await contract.derived_public_key({\n        path: args.path,\n        predecessor: args.predecessor,\n        domain_id: 1,\n      })) as `Ed25519:${string}`\n    }\n\n    if (this.rootPublicKey) {\n      const pubKey = cryptography.deriveChildPublicKey(\n        await this.getPublicKey(),\n        args.predecessor.toLowerCase(),\n        args.path,\n        KDF_CHAIN_IDS.NEAR\n      )\n      return pubKey\n    } else {\n      // Support for legacy contract\n      const contract = await this.getContract()\n      const najPubKey = await contract.derived_public_key(args)\n      return najToUncompressedPubKeySEC1(najPubKey as NajPublicKey)\n    }\n  }\n\n  async getPublicKey(): Promise<UncompressedPubKeySEC1> {\n    if (this.rootPublicKey) {\n      return najToUncompressedPubKeySEC1(this.rootPublicKey)\n    } else {\n      // Support for legacy contract\n      const contract = await this.getContract()\n      const najPubKey = await contract.public_key()\n      return najToUncompressedPubKeySEC1(najPubKey)\n    }\n  }\n\n  async sign(\n    args: SignArgs,\n    options?: {\n      nonce?: number\n    }\n  ): Promise<RSVSignature> {\n    this.requireAccount()\n\n    const deposit = await this.getCurrentSignatureDeposit()\n\n    const result = await sendTransactionUntil({\n      accountId: this.accountId,\n      keypair: this.keypair,\n      networkId: this.networkId,\n      receiverId: this.contractId,\n      actions: [\n        actionCreators.functionCall(\n          'sign',\n          { request: args },\n          BigInt(NEAR_MAX_GAS.toString()),\n          BigInt(deposit.toString())\n        ),\n      ],\n      nonce: options?.nonce,\n      options: this.sendTransactionOptions,\n    })\n\n    const signature = responseToMpcSignature({ response: result })\n\n    if (!signature) {\n      throw new Error('Transaction failed')\n    }\n\n    return signature\n  }\n\n  private requireAccount(): void {\n    if (this.accountId === DONT_CARE_ACCOUNT_ID) {\n      throw new Error(\n        'A valid account ID and keypair are required for change methods. Please instantiate a new contract with valid credentials.'\n      )\n    }\n  }\n}\n","import { CONTRACT_ADDRESSES, ROOT_PUBLIC_KEYS, type CHAINS } from '@constants'\nimport type { NajPublicKey } from '@types'\n\nexport const getRootPublicKey = (\n  contractAddress: string,\n  chain: keyof typeof CHAINS\n): NajPublicKey | undefined => {\n  const environment = Object.entries(CONTRACT_ADDRESSES[chain]).find(\n    ([_, address]) => address.toLowerCase() === contractAddress.toLowerCase()\n  )?.[0] as keyof typeof ROOT_PUBLIC_KEYS | undefined\n\n  if (environment) {\n    return ROOT_PUBLIC_KEYS[environment]\n  }\n\n  return undefined\n}\n","import { InMemoryKeyStore } from '@near-js/keystores'\nimport type { Action as TransactionAction } from '@near-js/transactions'\nimport type { TxExecutionStatus } from '@near-js/types'\nimport type {\n  Action as WalletAction,\n  FinalExecutionOutcome,\n  NetworkId,\n} from '@near-wallet-selector/core'\nimport BN from 'bn.js'\nimport {\n  transactions,\n  utils as nearUtils,\n  connect,\n  type KeyPair,\n} from 'near-api-js'\nimport { getTransactionLastResult } from 'near-api-js/lib/providers'\nimport { withRetry } from 'viem'\n\nimport { ChainSignatureContract } from '@contracts/near/ChainSignatureContract'\nimport { NEAR_MAX_GAS } from '@contracts/near/constants'\nimport { type ChainSignatureContractIds } from '@contracts/near/types'\nimport {\n  type RSVSignature,\n  type KeyDerivationPath,\n  type MPCSignature,\n  type HashToSign,\n} from '@types'\nimport { cryptography } from '@utils'\n\nexport const mpcPayloadsToChainSigTransaction = async ({\n  networkId,\n  contractId,\n  hashesToSign,\n  path,\n}: {\n  networkId: NetworkId\n  contractId: ChainSignatureContractIds\n  hashesToSign: HashToSign[]\n  path: KeyDerivationPath\n}): Promise<{\n  receiverId: string\n  actions: WalletAction[]\n}> => {\n  const contract = new ChainSignatureContract({\n    networkId,\n    contractId,\n  })\n\n  const currentContractFee = await contract.getCurrentSignatureDeposit()\n\n  return {\n    receiverId: contractId,\n    actions: hashesToSign.map((payload) => ({\n      type: 'FunctionCall',\n      params: {\n        methodName: 'sign',\n        args: {\n          request: {\n            payload: Array.from(payload),\n            path,\n            key_version: 0,\n          },\n        },\n        gas: NEAR_MAX_GAS.div(new BN(hashesToSign.length)).toString(),\n        deposit: currentContractFee?.toString() || '1',\n      },\n    })),\n  }\n}\n\nexport const responseToMpcSignature = ({\n  response,\n}: {\n  response: FinalExecutionOutcome\n}): RSVSignature | undefined => {\n  const signature = getTransactionLastResult(response) as MPCSignature\n\n  if (signature) {\n    return cryptography.toRSV(signature)\n  } else {\n    return undefined\n  }\n}\n\nexport interface SendTransactionOptions {\n  until: TxExecutionStatus\n  retryCount: number\n  delay: number\n  nodeUrl: string\n}\n\nexport const sendTransactionUntil = async ({\n  accountId,\n  keypair,\n  networkId,\n  receiverId,\n  actions,\n  nonce,\n  options = {\n    until: 'EXECUTED_OPTIMISTIC',\n    retryCount: 3,\n    delay: 5000, // Near RPC timeout\n    nodeUrl:\n      networkId === 'testnet'\n        ? 'https://test.rpc.fastnear.com'\n        : 'https://free.rpc.fastnear.com',\n  },\n}: {\n  accountId: string\n  keypair: KeyPair\n  networkId: NetworkId\n  receiverId: string\n  actions: TransactionAction[]\n  nonce?: number\n  options?: SendTransactionOptions\n}): Promise<FinalExecutionOutcome> => {\n  const keyStore = new InMemoryKeyStore()\n  await keyStore.setKey(networkId, accountId, keypair)\n\n  const near = await connect({\n    networkId,\n    keyStore,\n    nodeUrl: options.nodeUrl,\n  })\n\n  const { signer } = near.connection\n  const publicKey = await signer.getPublicKey(\n    accountId,\n    near.connection.networkId\n  )\n\n  const accessKey = (await near.connection.provider.query(\n    `access_key/${accountId}/${publicKey.toString()}`,\n    ''\n  )) as unknown as {\n    block_hash: string\n    block_height: number\n    nonce: number\n    permission: string\n  }\n\n  const recentBlockHash = nearUtils.serialize.base_decode(accessKey.block_hash)\n\n  const tx = transactions.createTransaction(\n    accountId,\n    publicKey,\n    receiverId,\n    nonce ?? ++accessKey.nonce,\n    actions,\n    recentBlockHash\n  )\n\n  const serializedTx = nearUtils.serialize.serialize(\n    transactions.SCHEMA.Transaction,\n    tx\n  )\n\n  const nearTransactionSignature = await signer.signMessage(\n    serializedTx,\n    accountId,\n    near.connection.networkId\n  )\n\n  const signedTransaction = new transactions.SignedTransaction({\n    transaction: tx,\n    signature: new transactions.Signature({\n      keyType: tx.publicKey.keyType,\n      data: nearTransactionSignature.signature,\n    }),\n  })\n\n  const { transaction } = await near.connection.provider.sendTransactionUntil(\n    signedTransaction,\n    'INCLUDED_FINAL'\n  )\n\n  const txHash = transaction.hash as string | undefined\n\n  if (!txHash) {\n    throw new Error('No transaction hash found')\n  }\n\n  return await withRetry(\n    async () => {\n      const txOutcome = await near.connection.provider.txStatus(\n        txHash,\n        accountId,\n        options.until\n      )\n\n      if (txOutcome) {\n        return txOutcome\n      }\n\n      throw new Error('Transaction not found')\n    },\n    {\n      retryCount: options.retryCount,\n      delay: options.delay,\n    }\n  )\n}\n"]}